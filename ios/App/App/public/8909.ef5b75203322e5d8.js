"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8909],{8909:(Q,D,c)=>{c.r(D),c.d(D,{EditDvirPageModule:()=>F});var g=c(6895),o=c(4006),u=c(6114),h=c(4529),p=c(5861),C=c(4171),e=c(8256),T=c(849),y=c(4382),b=c(9386),P=c(7219),_=c(3646);const A=["sPad"],k=["mechanicSPad"];function U(i,s){if(1&i&&(e.TgZ(0,"option",32),e._uU(1),e.qZA()),2&i){const t=s.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function E(i,s){if(1&i&&(e.TgZ(0,"option",32),e._uU(1),e.qZA()),2&i){const t=s.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function I(i,s){1&i&&e._UZ(0,"img",33)}function V(i,s){1&i&&e._UZ(0,"img",34)}function N(i,s){1&i&&e._UZ(0,"img",33)}function x(i,s){1&i&&e._UZ(0,"img",34)}function M(i,s){1&i&&e._UZ(0,"img",33)}function R(i,s){1&i&&e._UZ(0,"img",34)}function q(i,s){1&i&&e._UZ(0,"img",33)}function w(i,s){1&i&&e._UZ(0,"img",34)}function B(i,s){1&i&&e._UZ(0,"canvas",35,36)}const J=[{path:"",component:(()=>{class i{constructor(t,a,r,n,m,S,l,v){this.navCtrl=t,this.storage=a,this.databaseService=r,this.dashboardService=n,this.internetService=m,this.activatedRoute=S,this.formBuilder=l,this.router=v,this.defectsVehicle=["Air Compressor","Battery","Body","Brake Accessories","Coupling Devices","Drive Line","Exhaust","Fluid Levels","Front Axle","Headlights","Horn","Muffler","Parking Breaks","Reflectors","Service Breaks","Starter","Suspension System","Tire Chains","Transmission","Turn Indicators","Windows","Wipers & Washers","Air Lines","Belts & Hoses","Clutch","Defroster","Engine","Fifth Wheel","Frame & Assembly","Fuel Tanks","Heater","Mirrors","Oil Level","Radiator Level","Safety Equipment","Service Door","Steering","Tail Lights","Tires","Trip Recorder","Wheels & Rims","Windshield"],this.defectsTrailers=["Brake Connections","Coupling Devices","Doors","Landing Gear","Other","Roof","Suspension System","Wheels & Rims","Breaks","Coupling Pin","Hitch","Lights","Reflectors","Straps","Tarpaulin"],this.DvirStatuses=[{StatusCode:"VCS",StatusName:"Vehicle Condition Satisfactory"},{StatusCode:"D",StatusName:"Has Defects"},{StatusCode:"DC",StatusName:"Defects Corrected"},{StatusCode:"DNNBC",StatusName:"Defects Need Not Be Corrected"}],this.signaturePadOptions={minWidth:2,maxWidth:3,backgroundColor:"#FFFFFF",penColor:"black"},this.dvirs=[],this.bReady=!1,this.pickedVehicle="",this.vehicleId="",this.driverId="",this.networkStatus=!1,this.form=this.formBuilder.group({Date:[""],Time:[""],LocationDescription:["3mi from Chisinau, Chisinau"],VehicleUnit:[""],Trailers:[""],Odometer:["0"],DefectsVehicle:[""],DefectsTrailers:[""],Remarks:[""],StatusName:["",o.kI.required],StatusCode:["",o.kI.required],Comments:[""],Signature:["",o.kI.required],MechanicSignature:[""]})}ngOnInit(){var t=this;return(0,p.Z)(function*(){var a;t.activatedRoute.paramMap.subscribe(r=>{t.dvirId=r.get("dvirId")}),t.databaseSubscription=t.databaseService.databaseReadySubject.subscribe(r=>{r&&(t.bReady=r,t.databaseService.getCompany().subscribe(n=>{t.company=n}),t.databaseService.getDvirs().subscribe(n=>{t.dvirs=n,t.dvir=t.dvirs.find(m=>m.DVIRId===t.dvirId),t.dvir&&(t.initSignaturePad(),t.fillFormWithDvirData())}))}),t.pickedVehicle=yield t.storage.get("pickedVehicle"),t.vehicleId=yield t.storage.get("vehicleId"),t.driverId=yield t.storage.get("driverId"),null===(a=t.form.get("DefectsTrailers"))||void 0===a||a.valueChanges.subscribe(r=>{const n=t.form.get("Trailers");r&&r.length>0?null==n||n.setValidators(o.kI.required):null==n||n.clearValidators(),null==n||n.updateValueAndValidity()}),t.networkSub=t.internetService.internetStatus$.subscribe(r=>{t.networkStatus=r,console.log("Intenet Status"+r)})})()}switchStatus(t){"DC"!==t&&(this.mechanicSignaturePad=null),this.form.value.StatusCode=t}navigateBack(){this.router.navigate(["/unitab/dvir"])}ngAfterViewChecked(){"DC"===this.form.value.StatusCode&&this.mechanicSignaturePadElement&&this.mechanicSignaturePadElement.nativeElement&&!this.mechanicSignaturePad&&this.initMechanicalSignaturePad()}fillFormWithDvirData(){if(this.dvir){const t=this.dvir.DefectsVehicle.split(",").map(r=>r.trim()),a=this.dvir.DefectsTrailers.split(",").map(r=>r.trim());this.form.patchValue({Date:(0,g.p6)(this.dvir.CreateDate,"MMM d, y","en_US"),Time:(0,g.p6)(this.dvir.CreateDate,"h:mm a","en_US"),LocationDescription:this.dvir.LocationDescription,VehicleUnit:this.dvir.VehicleUnit,Trailers:this.dvir.Trailers,Odometer:this.dvir.Odometer,DefectsVehicle:t,DefectsTrailers:a,Remarks:this.dvir.Remarks,StatusName:this.dvir.StatusName,StatusCode:this.dvir.StatusCode,Signature:"data:image/png;base64,"+this.dvir.Signature,MechanicSignature:"data:image/png;base64,"+this.dvir.MechanicSignature||0})}}onSubmit(){var t=this;return(0,p.Z)(function*(){if(t.form.valid){const a=t.form.value.StatusCode,r=t.DvirStatuses.find(d=>d.StatusCode===a),n=(null==r?void 0:r.StatusName)||"",m=Array.isArray(t.form.value.DefectsVehicle)?t.form.value.DefectsVehicle.join(", "):t.form.value.DefectsVehicle||"",S=Array.isArray(t.form.value.DefectsTrailers)?t.form.value.DefectsTrailers.join(", "):t.form.value.DefectsTrailers||"";"DC"!==t.form.value.StatusCode&&t.form.patchValue({MechanicSignature:""});const l={DVIRId:t.dvir.DVIRId,CreateDate:t.dvir.CreateDate,VehicleUnit:t.pickedVehicle,VehicleId:t.vehicleId,DriverId:t.driverId,Trailers:t.form.value.Trailers,Odometer:t.form.value.Odometer,DefectsVehicle:m,DefectsTrailers:S,Remarks:t.form.value.Remarks||"",StatusCode:a,StatusName:n,Latitude:"0",Longitude:"0",LocationDescription:t.form.value.LocationDescription,Signature:t.form.value.Signature.slice(22),MechanicSignature:t.form.value.MechanicSignature.slice(22)||"",RepairDate:""};if(console.log(l),!0===t.networkStatus)t.dashboardService.updateDVIR(l).subscribe(d=>{console.log("DVIR is updated on server:",d)},function(){var d=(0,p.Z)(function*(f){console.log("Internet Status"+t.networkStatus);let Y={url:"api/EldDashboard/uploadDVIR",body:l},Z=yield t.storage.get("offlineArray");Z.push(Y),yield t.storage.set("offlineArray",Z),console.log("Pushed in offlineArray")});return function(f){return d.apply(this,arguments)}}());else{let d={url:"api/EldDashboard/uploadDVIR",body:l},f=yield t.storage.get("offlineArray");f.push(d),yield t.storage.set("offlineArray",f),console.log("Pushed in offlineArray")}const v=t.dvirs.findIndex(d=>d.DVIRId===t.dvirId);-1!==v&&(t.dvirs[v]=l),yield t.storage.set("dvirs",t.dvirs),t.navCtrl.navigateBack("/unitab/dvir")}})()}initSignaturePad(){const t=this.signaturePadElement.nativeElement;t&&(this.signaturePad=new C.Z(t,this.signaturePadOptions),t.addEventListener("touchend",()=>{this.updateSignatureField()}),this.dvir&&this.dvir.Signature&&this.renderSignature("data:image/png;base64,"+this.dvir.Signature))}initMechanicalSignaturePad(){console.log("vizvali");const t=this.mechanicSignaturePadElement.nativeElement;t&&(this.mechanicSignaturePad=new C.Z(t,this.signaturePadOptions),t.addEventListener("touchend",()=>{this.updateMechanicSignatureField()}),this.dvir&&this.dvir.MechanicSignature&&this.renderMechanicSignature("data:image/png;base64,"+this.dvir.MechanicSignature))}renderSignature(t){const a=this.signaturePadElement.nativeElement;if(a){const r=a.getContext("2d"),n=new Image;n.onload=()=>{null==r||r.drawImage(n,0,0)},n.src=t}}renderMechanicSignature(t){const a=this.mechanicSignaturePadElement.nativeElement;if(a){const r=a.getContext("2d"),n=new Image;n.onload=()=>{null==r||r.drawImage(n,0,0)},n.src=t}}clearSignature(){this.signaturePad&&(this.signaturePad.clear(),this.form.patchValue({Signature:""}))}clearMechanicSignature(){this.mechanicSignaturePad&&(this.mechanicSignaturePad.clear(),this.form.patchValue({MechanicSignature:""}))}updateSignatureField(){if(this.signaturePad&&!this.signaturePad.isEmpty()){const t=this.signaturePad.toDataURL();this.form.patchValue({Signature:t})}else this.form.patchValue({Signature:""})}updateMechanicSignatureField(){if(this.mechanicSignaturePad&&!this.mechanicSignaturePad.isEmpty()){const t=this.mechanicSignaturePad.toDataURL();this.form.patchValue({MechanicSignature:t})}else this.form.patchValue({MechanicSignature:""})}getCurrentDate(){return(new Date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}getCurrentTime(){return(new Date).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}ionViewWillEnter(){this.bReady&&(this.databaseSubscription=this.databaseService.getDvirs().subscribe(t=>{this.dvirs=t,console.log(this.dvirs)}))}ionViewWillLeave(){this.databaseSubscription&&this.databaseSubscription.unsubscribe(),this.networkSub.unsubscribe()}goBack(){this.navCtrl.navigateBack("/unitab/dvir")}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(u.SH),e.Y36(T.K),e.Y36(y.k),e.Y36(b.s),e.Y36(P.W),e.Y36(h.gz),e.Y36(o.qu),e.Y36(h.F0))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-edit-dvir"]],viewQuery:function(t,a){if(1&t&&(e.Gf(A,5),e.Gf(k,5)),2&t){let r;e.iGM(r=e.CRH())&&(a.signaturePadElement=r.first),e.iGM(r=e.CRH())&&(a.mechanicSignaturePadElement=r.first)}},decls:96,vars:16,consts:[[3,"title","backButton","backButtonCallback"],[1,"edit-form",3,"formGroup"],[1,"subtitle-lg"],[1,"edit-dvir-block"],[1,"input-block-2"],[1,"text-2"],["type","text","readonly","",1,"input-2","readonly",3,"value"],[1,"two-inputs"],["type","text","formControlName","Date","readonly","",1,"input-2","readonly","width-50"],["type","text","formControlName","Time","readonly","",1,"input-2","readonly","width-50"],["type","text","formControlName","LocationDescription","readonly","",1,"input-2","readonly"],["type","text","formControlName","VehicleUnit","readonly","",1,"input-2","readonly"],["type","text","formControlName","Odometer","readonly","",1,"input-2","readonly"],["type","text","formControlName","DefectsVehicle",1,"input-2","select"],[3,"value",4,"ngFor","ngForOf"],["type","text","formControlName","Trailers",1,"input-2"],["type","text","formControlName","DefectsTrailers",1,"input-2","select"],[1,"statuses"],[1,"status",3,"click"],["src","assets/icon/satis-success.svg","alt","ok"],[1,"text-success"],["src","assets/icon/circle-white.svg","alt","circle",4,"ngIf"],["src","assets/icon/check-mark.svg","alt","circle",4,"ngIf"],["src","assets/icon/satis-error.svg","alt","ok"],[1,"text-error"],["formControlName","Comments","name","comments","id","","cols","30","rows","10",1,"input-2"],[1,"ion-justify-content-center"],["size","auto"],["width","250","height","200",2,"touch-action","none","border","1px solid black"],["sPad",""],["required","","width","250","height","200","style","touch-action: none; border: 1px solid black",4,"ngIf"],["color","success","expand","block",1,"btn","primary-btn",3,"disabled","click"],[3,"value"],["src","assets/icon/circle-white.svg","alt","circle"],["src","assets/icon/check-mark.svg","alt","circle"],["required","","width","250","height","200",2,"touch-action","none","border","1px solid black"],["mechanicSPad",""]],template:function(t,a){1&t&&(e.TgZ(0,"ion-content")(1,"app-header",0),e.NdJ("backButtonCallback",function(){return a.goBack()}),e.qZA(),e.TgZ(2,"form",1)(3,"p",2),e._uU(4,"General Info"),e.qZA(),e.TgZ(5,"div",3)(6,"div",4)(7,"p",5),e._uU(8,"Company"),e.qZA(),e._UZ(9,"input",6),e.qZA(),e.TgZ(10,"div",4)(11,"p",5),e._uU(12,"Time"),e.qZA(),e.TgZ(13,"div",7),e._UZ(14,"input",8)(15,"input",9),e.qZA()(),e.TgZ(16,"div",4)(17,"p",5),e._uU(18,"Location"),e.qZA(),e._UZ(19,"input",10),e.qZA()(),e.TgZ(20,"p",2),e._uU(21,"Vehicle Info"),e.qZA(),e.TgZ(22,"div",3)(23,"div",4)(24,"p",5),e._uU(25,"Vehicle Name"),e.qZA(),e._UZ(26,"input",11),e.qZA(),e.TgZ(27,"div",4)(28,"p",5),e._uU(29,"Odometer"),e.qZA(),e._UZ(30,"input",12),e.qZA(),e.TgZ(31,"div",4)(32,"p",5),e._uU(33,"Vehicle Defects (Optional)"),e.qZA(),e.TgZ(34,"select",13),e.YNc(35,U,2,2,"option",14),e.qZA()()(),e.TgZ(36,"p",2),e._uU(37,"Trailer Info"),e.qZA(),e.TgZ(38,"div",3)(39,"div",4)(40,"p",5),e._uU(41,"Trailer Name"),e.qZA(),e._UZ(42,"input",15),e.qZA(),e.TgZ(43,"div",4)(44,"p",5),e._uU(45,"Trailer Defects (Optional)"),e.qZA(),e.TgZ(46,"select",16),e.YNc(47,E,2,2,"option",14),e.qZA()()(),e.TgZ(48,"p",2),e._uU(49,"Status"),e.qZA(),e.TgZ(50,"div",3)(51,"div",4)(52,"p",5),e._uU(53,"Status"),e.qZA(),e.TgZ(54,"div",17)(55,"div",18),e.NdJ("click",function(){return a.switchStatus("VCS")}),e._UZ(56,"img",19),e.TgZ(57,"p",20),e._uU(58,"Satisfactory Condition"),e.qZA(),e.YNc(59,I,1,0,"img",21),e.YNc(60,V,1,0,"img",22),e.qZA(),e.TgZ(61,"div",18),e.NdJ("click",function(){return a.switchStatus("D")}),e._UZ(62,"img",23),e.TgZ(63,"p",24),e._uU(64,"Has Defects"),e.qZA(),e.YNc(65,N,1,0,"img",21),e.YNc(66,x,1,0,"img",22),e.qZA(),e.TgZ(67,"div",18),e.NdJ("click",function(){return a.switchStatus("DC")}),e._UZ(68,"img",19),e.TgZ(69,"p",20),e._uU(70,"Defects Corrected"),e.qZA(),e.YNc(71,M,1,0,"img",21),e.YNc(72,R,1,0,"img",22),e.qZA(),e.TgZ(73,"div",18),e.NdJ("click",function(){return a.switchStatus("DNNBC")}),e._UZ(74,"img",23),e.TgZ(75,"p",24),e._uU(76,"Defects Need Not To Be Corrected"),e.qZA(),e.YNc(77,q,1,0,"img",21),e.YNc(78,w,1,0,"img",22),e.qZA()()(),e.TgZ(79,"div",4)(80,"p",5),e._uU(81,"Comments"),e.qZA(),e._UZ(82,"textarea",25),e.qZA()(),e.TgZ(83,"p",2),e._uU(84,"Signature"),e.qZA(),e.TgZ(85,"ion-row",26)(86,"ion-col",27),e._UZ(87,"canvas",28,29),e.qZA()(),e.TgZ(89,"p",2),e._uU(90,"Mechanical Signature"),e.qZA(),e.TgZ(91,"ion-row",26)(92,"ion-col",27),e.YNc(93,B,2,0,"canvas",30),e.qZA()(),e.TgZ(94,"button",31),e.NdJ("click",function(){return a.onSubmit()}),e._uU(95,"Save"),e.qZA()()()),2&t&&(e.xp6(1),e.Q6J("title","Edit Dvir")("backButton",!0),e.xp6(1),e.Q6J("formGroup",a.form),e.xp6(7),e.Q6J("value",null==a.company?null:a.company.name),e.xp6(26),e.Q6J("ngForOf",a.defectsVehicle),e.xp6(12),e.Q6J("ngForOf",a.defectsTrailers),e.xp6(12),e.Q6J("ngIf","VCS"!==a.form.value.StatusCode),e.xp6(1),e.Q6J("ngIf","VCS"===a.form.value.StatusCode),e.xp6(5),e.Q6J("ngIf","D"!==a.form.value.StatusCode),e.xp6(1),e.Q6J("ngIf","D"===a.form.value.StatusCode),e.xp6(5),e.Q6J("ngIf","DC"!==a.form.value.StatusCode),e.xp6(1),e.Q6J("ngIf","DC"===a.form.value.StatusCode),e.xp6(5),e.Q6J("ngIf","DNNBC"!==a.form.value.StatusCode),e.xp6(1),e.Q6J("ngIf","DNNBC"===a.form.value.StatusCode),e.xp6(15),e.Q6J("ngIf","DC"===a.form.value.StatusCode),e.xp6(1),e.Q6J("disabled",!a.form.valid))},dependencies:[g.sg,g.O5,o._Y,o.YN,o.Kr,o.Fj,o.EJ,o.JJ,o.JL,u.wI,u.W2,u.Nd,o.sg,o.u,_.G],styles:[".underline-text[_ngcontent-%COMP%]{text-decoration:underline;color:#00f}.text-success[_ngcontent-%COMP%]{flex-grow:1;color:var(--success-500);font-size:16px;font-weight:500}.text-error[_ngcontent-%COMP%]{flex-grow:1;color:var(--error-500);font-size:16px;font-weight:600}.input-block-2[_ngcontent-%COMP%]   textarea.input-2[_ngcontent-%COMP%]{height:89px;resize:none}.btn[_ngcontent-%COMP%]{width:100%;height:50px;border-radius:30px}.edit-form[_ngcontent-%COMP%]{padding:10px 30px 30px}"]}),i})()}];let O=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[h.Bz.forChild(J),h.Bz]}),i})();var L=c(4546);let F=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[u.X1],imports:[g.ez,o.u5,u.Pc,O,o.UX,L.y]}),i})()}}]);