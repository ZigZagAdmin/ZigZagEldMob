"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9306],{9306:(J,d,o)=>{o.r(d),o.d(d,{LogCertifyPageModule:()=>T});var r=o(6895),p=o(4006),g=o(6114),l=o(5050),c=o(5861),y=o(4171),t=o(8256),m=o(4382),v=o(4465),C=o(9386),P=o(849),b=o(7278),x=o(3646);const L=["sPad"];function k(i,s){1&i&&t._UZ(0,"ion-spinner",22)}const f=function(i){return{"no-display":i}};function S(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div",18),t._UZ(1,"img",19),t.TgZ(2,"img",20),t.NdJ("load",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.imageLoaded())}),t.qZA(),t.YNc(3,k,1,0,"ion-spinner",21),t.qZA()}if(2&i){const e=t.oxw();t.xp6(1),t.Q6J("src",e.signatureLink,t.LSH),t.xp6(1),t.Q6J("ngClass",t.VKq(4,f,e.imageLoading))("src",e.logDaily.form.signatureLink,t.LSH),t.xp6(1),t.Q6J("ngIf",e.imageLoading)}}function D(i,s){1&i&&(t.TgZ(0,"span"),t._uU(1,"Save"),t.qZA())}function M(i,s){1&i&&t._UZ(0,"ion-spinner",23)}const h=function(i){return{"disable-click":i}},Z=function(i){return{"btn-disabled":i}},_=[{path:"",component:(()=>{class i{constructor(e,n,a,u,B,A,F){this.navCtrl=e,this.route=n,this.databaseService=a,this.toastService=u,this.dashboardService=B,this.storage=A,this.utilityService=F,this.loading=!1,this.logDate="",this.logId="",this.signature="",this.signatureFound=!1,this.foundSignatureId="",this.imageLoading=!1,this.signatureLink="",this.isConfirmButtonActive=!1,this.signaturePadOptions={minWidth:2,maxWidth:3,backgroundColor:"#FFFFFF",penColor:"black"}}ngOnInit(){this.routeSubscription=this.route.queryParams.subscribe(e=>{this.logDate=e.date,this.logId=e.logId}),this.logDailies$=this.databaseService.getLogDailies().subscribe(e=>{this.logDailies=e,this.logDaily=this.logDailies.find(n=>n.logDailyId===this.logId),console.log(this.logDaily)})}ngAfterViewInit(){this.initSignaturePad()}ngOnDestroy(){this.logDailies$.unsubscribe()}goBack(){this.navCtrl.navigateBack(["log-item",this.logId])}initSignaturePad(){const e=this.signaturePad.nativeElement;e&&(this.signaturePadEl=new y.Z(e,this.signaturePadOptions),e.addEventListener("touchend",()=>{this.updateSignatureField()}))}restoreSignature(){var e=this;return(0,c.Z)(function*(){const n=e.logDailies.find(a=>""!==a.form.signatureId&&"00000000-0000-0000-0000-000000000000"!==a.form.signatureId);n?(e.signature="",e.signatureLink=n.form.signatureLink,e.foundSignatureId=n.form.signatureId,console.log(n),e.signatureFound=!0,e.activateSave()):(e.signatureFound=!1,e.toastService.showToast("No signature found on other daily logs."))})()}updateSignatureField(){if(this.signaturePad&&!this.signaturePadEl.isEmpty()){const e=this.signaturePadEl.toDataURL().slice(22);this.signature=e}else this.signature="";this.activateSave()}clearSignature(){this.signatureFound&&(this.signatureFound=!1),this.signaturePad&&(this.signaturePadEl.clear(),this.signature=""),this.isConfirmButtonActive=!1}save(){var e=this;this.loading=!0,this.signatureFound?(this.logDaily.form.signatureId=this.foundSignatureId,this.logDaily.certified=!0):(this.logDaily.form.signatureId=this.utilityService.uuidv4(),this.logDaily.form.signature=this.signature,this.logDaily.certified=!0),this.dashboardService.updateLogDaily(this.logDaily).subscribe(n=>{this.toastService.showToast("Successfully signed the log certification.","success"),this.loading=!1,this.updateLocalStorage(),this.goBack()},function(){var n=(0,c.Z)(function*(a){e.loading=!1,e.toastService.showToast("Could not update the signture. Uploading offline only."),e.updateLocalStorage(),e.goBack()});return function(a){return n.apply(this,arguments)}}())}activateSave(){this.isConfirmButtonActive=!!(this.signature&&0!==this.signature.length||this.signatureLink&&0!==this.signatureLink.length)}imageLoaded(){this.imageLoading=!1}updateLocalStorage(){var e=this;return(0,c.Z)(function*(){let n=yield e.storage.get("logDailies"),a=n.findIndex(u=>u.logDailyId===e.logDaily.logDailyId);n.splice(a,1,e.logDaily),yield e.storage.set("logDailies",n),console.log("log-certify: logDailies updated in the storage")})()}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(g.SH),t.Y36(l.gz),t.Y36(m.k),t.Y36(v.k),t.Y36(C.s),t.Y36(P.K),t.Y36(b.t))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-log-certify"]],viewQuery:function(e,n){if(1&e&&t.Gf(L,5),2&e){let a;t.iGM(a=t.CRH())&&(n.signaturePad=a.first)}},decls:26,vars:24,consts:[[3,"fullscreen","forceOverscroll"],[3,"title","backButton","backButtonCallback"],[1,"date-label"],[1,"main-container","padding-g"],[1,"canvas-container"],["height","290",2,"touch-action","none","user-select","none",3,"ngClass"],["sPad",""],["class","image-container",4,"ngIf"],[1,"signature-buttons"],[1,"signature-button",3,"click"],[2,"display","flex","flex-direction","column","gap","20px"],[1,"confirm-checkbox"],[1,"checkbox-text"],[1,"confirm-buttons"],[1,"custom-btn","secondary-btn",3,"ngClass","click"],[1,"custom-btn","primary-btn",3,"ngClass","disabled","click"],[4,"ngIf"],["name","circular","color","light","class","spinner",4,"ngIf"],[1,"image-container"],[3,"src"],[3,"ngClass","src","load"],["name","dots","color","dark",4,"ngIf"],["name","dots","color","dark"],["name","circular","color","light",1,"spinner"]],template:function(e,n){1&e&&(t.TgZ(0,"ion-content",0)(1,"app-header",1),t.NdJ("backButtonCallback",function(){return n.goBack()}),t.TgZ(2,"div",2),t._uU(3),t.ALo(4,"date"),t.qZA()(),t.TgZ(5,"div",3)(6,"div")(7,"div",4),t._UZ(8,"canvas",5,6),t.YNc(10,S,4,6,"div",7),t.qZA(),t.TgZ(11,"div",8)(12,"div",9),t.NdJ("click",function(){return n.clearSignature()}),t._uU(13,"Clear signature"),t.qZA(),t.TgZ(14,"div",9),t.NdJ("click",function(){return n.restoreSignature()}),t._uU(15,"Restore signature"),t.qZA()()(),t.TgZ(16,"div",10)(17,"div",11)(18,"div",12),t._uU(19,"I hereby certify that my data entries and my record of duty status for this 24-hour period are true and correct."),t.qZA()(),t.TgZ(20,"div",13)(21,"button",14),t.NdJ("click",function(){return n.goBack()}),t._uU(22,"Back"),t.qZA(),t.TgZ(23,"button",15),t.NdJ("click",function(){return n.save()}),t.YNc(24,D,2,0,"span",16),t.YNc(25,M,1,0,"ion-spinner",17),t.qZA()()()()()),2&e&&(t.Q6J("fullscreen",!0)("forceOverscroll",!1),t.xp6(1),t.Q6J("title","Certify")("backButton",!0),t.xp6(2),t.Oqu(t.xi3(4,13,n.logDate,"EEEE, MMM d")),t.xp6(5),t.Q6J("ngClass",t.VKq(16,f,n.signatureFound)),t.xp6(2),t.Q6J("ngIf",n.signatureFound),t.xp6(11),t.Q6J("ngClass",t.VKq(18,h,n.loading)),t.xp6(2),t.Q6J("ngClass",t.VKq(20,Z,!n.isConfirmButtonActive))("ngClass",t.VKq(22,h,n.loading))("disabled",!n.isConfirmButtonActive),t.xp6(1),t.Q6J("ngIf",!n.loading),t.xp6(1),t.Q6J("ngIf",n.loading))},dependencies:[r.mk,r.O5,g.W2,g.PQ,x.G,r.uU],styles:[".main-container[_ngcontent-%COMP%]{width:100%;height:calc(100% - 47px);display:flex;flex-direction:column;justify-content:space-between}.date-label[_ngcontent-%COMP%]{color:var(--gray-700);font-size:18px;font-weight:600}.canvas-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%;height:320px;max-width:500px;background-color:var(--gray-100);border-radius:10px;padding:15px}.canvas-container[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:10px}.signature-buttons[_ngcontent-%COMP%]{display:flex;gap:30px;margin-top:10px}.signature-button[_ngcontent-%COMP%]{font-size:15px;font-weight:500;color:var(--gray-500)}.confirm-buttons[_ngcontent-%COMP%]{display:flex;gap:15px}.custom-btn[_ngcontent-%COMP%]{flex:1;display:flex;justify-content:center;align-items:center;padding:15px;border-radius:30px;font-size:16px;font-weight:600;max-height:49px}.confirm-checkbox[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:15px}.checkbox-text[_ngcontent-%COMP%]{font-size:14px;color:var(--gray-700);font-weight:500}ion-checkbox[_ngcontent-%COMP%]{--size: 20px;--checkbox-background-checked: var(--success-500);--border-color: var(--gray-200);--border-color-checked: transparent;--checkmark-width: 2px}ion-checkbox[_ngcontent-%COMP%]::part(container){border-radius:50%}.btn-disabled[_ngcontent-%COMP%]{background-color:var(--gray-500)!important}.spinner[_ngcontent-%COMP%]{transform:scale(.9)}.image-container[_ngcontent-%COMP%]{width:100%;background-color:#fff;border-radius:10px;display:flex;justify-content:center;align-items:center}.image-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:10px}.no-display[_ngcontent-%COMP%]{display:none;width:0;height:0;border:none}"]}),i})()}];let I=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[l.Bz.forChild(_),l.Bz]}),i})();var O=o(4546);let T=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[r.ez,p.u5,g.Pc,I,O.y]}),i})()}}]);