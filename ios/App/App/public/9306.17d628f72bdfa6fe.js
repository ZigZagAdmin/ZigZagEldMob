"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9306],{9306:(P,h,o)=>{o.r(h),o.d(h,{LogCertifyPageModule:()=>Z});var c=o(6895),p=o(4006),u=o(6114),d=o(4529),r=o(5861),m=o(4171),t=o(8256),v=o(4382),y=o(4465),g=o(9386),f=o(849),b=o(7278),x=o(3646);const _=["sPad"];function L(n,s){1&n&&t._UZ(0,"ion-spinner",22)}const C=function(n){return{"no-display":n}};function k(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"div",18),t._UZ(1,"img",19),t.TgZ(2,"img",20),t.NdJ("load",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.imageLoaded())}),t.qZA(),t.YNc(3,L,1,0,"ion-spinner",21),t.qZA()}if(2&n){const e=t.oxw();t.xp6(1),t.Q6J("src",e.signatureLink,t.LSH),t.xp6(1),t.Q6J("ngClass",t.VKq(4,C,e.imageLoading))("src",e.logDaily.form.signatureLink,t.LSH),t.xp6(1),t.Q6J("ngIf",e.imageLoading)}}function S(n,s){1&n&&(t.TgZ(0,"span"),t._uU(1,"Save"),t.qZA())}function T(n,s){1&n&&t._UZ(0,"ion-spinner",23)}const M=function(n){return{"btn-disabled":n}},D=[{path:"",component:(()=>{class n{constructor(e,i,a,l,E,B,A){this.navCtrl=e,this.route=i,this.databaseService=a,this.toastService=l,this.dashboardService=E,this.storage=B,this.utilityService=A,this.loading=!1,this.backUrl="",this.logDate="",this.logId="",this.signature="",this.signatureFound=!1,this.foundSignatureId="",this.imageLoading=!1,this.signatureLink="",this.isConfirmButtonActive=!1,this.signaturePadOptions={minWidth:2,maxWidth:3,backgroundColor:"#FFFFFF",penColor:"black"}}ngOnInit(){this.routeSubscription=this.route.queryParams.subscribe(e=>{this.backUrl=e.url,this.logDate=e.date,this.logId=e.logId}),this.logDailies$=this.databaseService.getLogDailies().subscribe(e=>{this.logDailies=e,this.logDaily=this.logDailies.find(i=>i.logDailyId===this.logId),console.log(this.logDaily)})}ngAfterViewInit(){this.initSignaturePad()}ngOnDestroy(){this.logDailies$.unsubscribe()}goBack(){this.navCtrl.navigateBack(this.backUrl)}initSignaturePad(){const e=this.signaturePad.nativeElement;e&&(this.signaturePadEl=new m.Z(e,this.signaturePadOptions),e.addEventListener("touchend",()=>{this.updateSignatureField()}))}restoreSignature(){var e=this;return(0,r.Z)(function*(){const i=e.logDailies.find(a=>""!==a.form.signatureId&&"00000000-0000-0000-0000-000000000000"!==a.form.signatureId);i?(e.signature="",e.signatureLink=i.form.signatureLink,e.foundSignatureId=i.form.signatureId,console.log(i),e.signatureFound=!0,e.activateSave()):(e.signatureFound=!1,e.toastService.showToast("No signature found on other daily logs."))})()}renderSignature(e){const i=this.signaturePad.nativeElement;if(i){const a=i.getContext("2d"),l=new Image;l.onload=()=>{null==a||a.drawImage(l,0,0)},l.src="data:image/png;base64,"+e,this.signature=e}}updateSignatureField(){if(this.signaturePad&&!this.signaturePadEl.isEmpty()){const e=this.signaturePadEl.toDataURL().slice(22);this.signature=e}else this.signature="";this.activateSave()}clearSignature(){this.signatureFound&&(this.signatureFound=!1),this.signaturePad&&(this.signaturePadEl.clear(),this.signature=""),this.isConfirmButtonActive=!1}save(){var e=this;this.loading=!0,this.signatureFound?this.logDaily.form.signatureId=this.foundSignatureId:(this.logDaily.form.signatureId=this.utilityService.uuidv4(),this.logDaily.form.signature=this.signature,this.logDaily.certified=!0),this.dashboardService.updateLogDaily(this.logDaily).subscribe(i=>{this.toastService.showToast("Successfully sign the log certification.","success"),this.loading=!1,this.updateLocalStorage(),this.goBack()},function(){var i=(0,r.Z)(function*(a){e.loading=!1,e.updateLocalStorage()});return function(a){return i.apply(this,arguments)}}())}activateSave(){this.isConfirmButtonActive=0!==this.signature.length||0!==this.signatureLink.length}imageLoaded(){this.imageLoading=!1}updateLocalStorage(){var e=this;return(0,r.Z)(function*(){let i=yield e.storage.get("logDailies"),a=i.findIndex(l=>l.logDailyId===e.logDaily.logDailyId);i.splice(a,1,e.logDaily),yield e.storage.set("logDailies",i),console.log("log-certify: logDailies updated in the storage")})()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(u.SH),t.Y36(d.gz),t.Y36(v.k),t.Y36(y.k),t.Y36(g.s),t.Y36(f.K),t.Y36(b.t))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-log-certify"]],viewQuery:function(e,i){if(1&e&&t.Gf(_,5),2&e){let a;t.iGM(a=t.CRH())&&(i.signaturePad=a.first)}},decls:26,vars:18,consts:[[3,"fullscreen","forceOverscroll"],[3,"title","backButton","backButtonCallback"],[1,"date-label"],[1,"main-container","padding-g"],[1,"canvas-container"],["height","290",2,"touch-action","none","user-select","none",3,"ngClass"],["sPad",""],["class","image-container",4,"ngIf"],[1,"signature-buttons"],[1,"signature-button",3,"click"],[2,"display","flex","flex-direction","column","gap","20px"],[1,"confirm-checkbox"],[1,"checkbox-text"],[1,"confirm-buttons"],[1,"custom-btn","secondary-btn",3,"click"],[1,"custom-btn","primary-btn",3,"ngClass","disabled","click"],[4,"ngIf"],["name","circular","color","light","class","spinner",4,"ngIf"],[1,"image-container"],[3,"src"],[3,"ngClass","src","load"],["name","dots","color","dark",4,"ngIf"],["name","dots","color","dark"],["name","circular","color","light",1,"spinner"]],template:function(e,i){1&e&&(t.TgZ(0,"ion-content",0)(1,"app-header",1),t.NdJ("backButtonCallback",function(){return i.goBack()}),t.TgZ(2,"div",2),t._uU(3),t.ALo(4,"date"),t.qZA()(),t.TgZ(5,"div",3)(6,"div")(7,"div",4),t._UZ(8,"canvas",5,6),t.YNc(10,k,4,6,"div",7),t.qZA(),t.TgZ(11,"div",8)(12,"div",9),t.NdJ("click",function(){return i.clearSignature()}),t._uU(13,"Clear signature"),t.qZA(),t.TgZ(14,"div",9),t.NdJ("click",function(){return i.restoreSignature()}),t._uU(15,"Restore signature"),t.qZA()()(),t.TgZ(16,"div",10)(17,"div",11)(18,"div",12),t._uU(19,"I hereby certify that my data entries and my record of duty status for this 24-hour period are true and correct."),t.qZA()(),t.TgZ(20,"div",13)(21,"button",14),t.NdJ("click",function(){return i.goBack()}),t._uU(22,"Back"),t.qZA(),t.TgZ(23,"button",15),t.NdJ("click",function(){return i.save()}),t.YNc(24,S,2,0,"span",16),t.YNc(25,T,1,0,"ion-spinner",17),t.qZA()()()()()),2&e&&(t.Q6J("fullscreen",!0)("forceOverscroll",!1),t.xp6(1),t.Q6J("title","Certify")("backButton",!0),t.xp6(2),t.Oqu(t.xi3(4,11,i.logDate,"EEEE, MMM d")),t.xp6(5),t.Q6J("ngClass",t.VKq(14,C,i.signatureFound)),t.xp6(2),t.Q6J("ngIf",i.signatureFound),t.xp6(13),t.Q6J("ngClass",t.VKq(16,M,!i.isConfirmButtonActive))("disabled",!i.isConfirmButtonActive),t.xp6(1),t.Q6J("ngIf",!i.loading),t.xp6(1),t.Q6J("ngIf",i.loading))},dependencies:[c.mk,c.O5,u.W2,u.PQ,x.G,c.uU],styles:[".main-container[_ngcontent-%COMP%]{width:100%;height:calc(100% - 47px);display:flex;flex-direction:column;justify-content:space-between}.date-label[_ngcontent-%COMP%]{color:var(--gray-700);font-size:18px;font-weight:600}.canvas-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%;height:320px;max-width:500px;background-color:var(--gray-100);border-radius:10px;padding:15px}.canvas-container[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:10px}.signature-buttons[_ngcontent-%COMP%]{display:flex;gap:30px;margin-top:10px}.signature-button[_ngcontent-%COMP%]{font-size:15px;font-weight:500;color:var(--gray-500)}.confirm-buttons[_ngcontent-%COMP%]{display:flex;gap:15px}.custom-btn[_ngcontent-%COMP%]{flex:1;display:flex;justify-content:center;align-items:center;padding:15px;border-radius:30px;font-size:16px;font-weight:600;max-height:49px}.confirm-checkbox[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:15px}.checkbox-text[_ngcontent-%COMP%]{font-size:14px;color:var(--gray-700);font-weight:500}ion-checkbox[_ngcontent-%COMP%]{--size: 20px;--checkbox-background-checked: var(--success-500);--border-color: var(--gray-200);--border-color-checked: transparent;--checkmark-width: 2px}ion-checkbox[_ngcontent-%COMP%]::part(container){border-radius:50%}.btn-disabled[_ngcontent-%COMP%]{background-color:var(--gray-500)!important}.spinner[_ngcontent-%COMP%]{transform:scale(.9)}.image-container[_ngcontent-%COMP%]{width:100%;background-color:#fff;border-radius:10px;display:flex;justify-content:center;align-items:center}.image-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:10px}.no-display[_ngcontent-%COMP%]{display:none;width:0;height:0;border:none}"]}),n})()}];let I=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[d.Bz.forChild(D),d.Bz]}),n})();var O=o(4546);let Z=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[c.ez,p.u5,u.Pc,I,O.y]}),n})()},4465:(P,h,o)=>{o.d(h,{k:()=>d});var c=o(5861),p=o(8256),u=o(6114);let d=(()=>{class r{constructor(t){this.toastController=t}showToast(t,v="danger",y=1e3){var g=this;return(0,c.Z)(function*(){g.currentToast&&(yield g.dismissToast());const f=yield g.toastController.create({message:t,duration:y,color:v});g.currentToast=f,f.onDidDismiss().then(()=>{g.currentToast=null}),f.present()})()}dismissToast(){var t=this;return(0,c.Z)(function*(){t.currentToast&&(yield t.toastController.dismiss(),t.currentToast=null)})()}}return r.\u0275fac=function(t){return new(t||r)(p.LFG(u.yF))},r.\u0275prov=p.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})()}}]);