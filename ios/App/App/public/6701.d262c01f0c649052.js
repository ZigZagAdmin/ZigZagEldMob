"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6701,3646,4576],{3646:(U,C,d)=>{d.d(C,{G:()=>p});var i=d(8256),k=d(6895);function b(D,M){if(1&D){const y=i.EpF();i.TgZ(0,"img",6),i.NdJ("click",function(){i.CHM(y);const S=i.oxw();return i.KtG(S.goBack())}),i.qZA()}}const O=["*"];let p=(()=>{class D{constructor(){this.backButton=!1,this.backButtonCallback=new i.vpe}ngOnInit(){}goBack(){this.backButtonCallback.emit()}}return D.\u0275fac=function(y){return new(y||D)},D.\u0275cmp=i.Xpm({type:D,selectors:[["app-header"]],inputs:{title:"title",subtitle:"subtitle",backButton:"backButton"},outputs:{backButtonCallback:"backButtonCallback"},ngContentSelectors:O,decls:9,vars:3,consts:[[1,"title-container","padding-g"],[2,"display","flex","justify-content","space-between","align-items","center"],[1,"title-back"],["src","../../../assets/imgs/back-arrow.png",3,"click",4,"ngIf"],[1,"page-title"],[1,"subtitle","custom-subtitle"],["src","../../../assets/imgs/back-arrow.png",3,"click"]],template:function(y,Z){1&y&&(i.F$t(),i.TgZ(0,"div",0)(1,"div",1)(2,"div",2),i.YNc(3,b,1,0,"img",3),i.TgZ(4,"div",4),i._uU(5),i.qZA()(),i.Hsn(6),i.qZA(),i.TgZ(7,"div",5),i._uU(8),i.qZA()()),2&y&&(i.xp6(3),i.Q6J("ngIf",Z.backButton),i.xp6(2),i.Oqu(Z.title),i.xp6(3),i.hij(" ",Z.subtitle," "))},dependencies:[k.O5],styles:[".title-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.title-back[_ngcontent-%COMP%]{display:flex;align-items:center;gap:15px}.title-back[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:20px;height:20px}.custom-subtitle[_ngcontent-%COMP%]{margin-left:35px}.title-container[_ngcontent-%COMP%]{padding-bottom:0}"]}),D})()},2187:(U,C,d)=>{d.d(C,{a:()=>S});var i=d(8256),k=d(4465),b=d(6994),O=d(6895),p=d(4006);const D=function(t,x,c,h){return{"label-error":t,"input-label-top":x,"input-label-left":c,"no-label":h}};function M(t,x){if(1&t&&(i.TgZ(0,"div",3),i._uU(1),i.qZA()),2&t){const c=i.oxw();i.Q6J("ngClass",i.l5B(3,D,!c.valid,"top"===c.labelPosition,"left"===c.labelPosition,"none"===c.label)),i.xp6(1),i.AsE(" ",c.label,"",c.required?"*":""," ")}}const y=function(t,x){return{"custom-input-top":t,"custom-input-left":x}},Z=function(t,x,c,h){return{"input-fill":t,"validation-error":x,"input-left":c,"disable-input-opacity":h}};let S=(()=>{class t{constructor(c,h,I){this.toastService=c,this.shareService=h,this.elementRef=I,this.type="text",this.placeholder="",this.fill=!0,this.validators=[],this.noValidation=!1,this.disabled=!1,this.showDisabled=!1,this.required=!1,this.labelPosition="top",this.valueChange=new i.vpe,this.validationChange=new i.vpe,this.valid=!0}get value(){return this._value}set value(c){this._value!==c&&(this._value=c,this.valueChange.emit(c))}get validation(){return this._validation}set validation(c){this._validation!==c&&(this._validation=c,this.validationChange.emit(c))}ngOnInit(){this.validateSubscription=this.shareService.currentMessage.subscribe(c=>{"reset"===c?this.valid=!0:"invalidate"!==c||this.noValidation?c&&0!==c.length&&this.validateInput():this.valid=!1})}ngOnDestroy(){this.validateSubscription.unsubscribe()}onInputChange(c){0!==c.target.value&&(this.valid=!0),this.value=c.target.value,this.valueChange.emit(this.value)}validateInput(){!this.noValidation&&null!==this.elementRef.nativeElement.offsetParent&&(0===this.value.length?(this.valid=!1,this.toastService.showToast("Field required")):this.value.length>0&&(this.valid=!0),this.value.length>=0&&0!==this.validators.length&&this.validators.every(c=>!!c.regex.test(this.value)||(this.valid=!0,this.toastService.showToast(c.message),!1)),this.validation=this.valid)}}return t.\u0275fac=function(c){return new(c||t)(i.Y36(k.k),i.Y36(b.t),i.Y36(i.SBq))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-input"]],inputs:{label:"label",type:"type",placeholder:"placeholder",fill:"fill",validators:"validators",noValidation:"noValidation",disabled:"disabled",showDisabled:"showDisabled",required:"required",labelPosition:"labelPosition",value:"value",validation:"validation"},outputs:{valueChange:"valueChange",validationChange:"validationChange"},decls:3,vars:15,consts:[[1,"custom-input",3,"ngClass"],["class","input-label",3,"ngClass",4,"ngIf"],["autocomplete","one-time-code",1,"input-box",3,"type","ngModel","readonly","placeholder","ngClass","input","ngModelChange"],[1,"input-label",3,"ngClass"]],template:function(c,h){1&c&&(i.TgZ(0,"div",0),i.YNc(1,M,2,8,"div",1),i.TgZ(2,"input",2),i.NdJ("input",function(P){return h.onInputChange(P)})("ngModelChange",function(P){return h.value=P}),i.qZA()()),2&c&&(i.Q6J("ngClass",i.WLB(7,y,"top"===h.labelPosition,"left"===h.labelPosition)),i.xp6(1),i.Q6J("ngIf",h.label),i.xp6(1),i.Q6J("type",h.type)("ngModel",h.value)("readonly",h.disabled)("placeholder",h.placeholder)("ngClass",i.l5B(10,Z,h.fill,!h.valid,"left"===h.labelPosition,h.showDisabled)))},dependencies:[O.mk,O.O5,p.Fj,p.JJ,p.On],styles:[".custom-input[_ngcontent-%COMP%]{width:100%;height:-moz-fit-content;height:fit-content}.custom-input-top[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:5px}.custom-input-left[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;align-items:center;gap:24px}.input-label[_ngcontent-%COMP%]{color:var(--gray-500)}.input-label-top[_ngcontent-%COMP%]{font-size:14px;font-weight:400}.input-label-left[_ngcontent-%COMP%]{flex:1;font-size:15px;font-weight:600}.input-box[_ngcontent-%COMP%]{width:100%;height:45px;border-radius:10px;padding:15px;font-size:14px;font-weight:400;color:var(--gray-500)!important;border:1px solid var(--gray-200);background-color:transparent}.input-box[_ngcontent-%COMP%]:focus{color:var(--gray-500)!important;outline:none;border:1px solid var(--gray-300)}.input-fill[_ngcontent-%COMP%]{border:none!important;background-color:var(--gray-100)}.input-left[_ngcontent-%COMP%]{flex:1}.validation-error[_ngcontent-%COMP%]{border:1px solid var(--error-600)!important}.validation-error[_ngcontent-%COMP%]:focus{border:1px solid var(--error-600)!important}.label-error[_ngcontent-%COMP%]{color:var(--error-600)}.no-label[_ngcontent-%COMP%]{color:transparent!important}"]}),t})()},6701:(U,C,d)=>{d.r(C),d.d(C,{EditDutyStatusPageModule:()=>Tt});var i=d(6895),k=d(4006),b=d(7151),O=d(5050),p=d(5861),D=d(7423),M=d(5670),y=d(3905),Z=d(4128),S=d(2368),t=d(8256),x=d(7278),c=d(849),h=d(4382),I=d(4465),P=d(6994),N=d(9386),J=d(7080),H=d(3646),F=d(2187),Y=d(7772),q=d(8837);const R=function(o,u,e){return{"label-error":o,"input-label-top":u,"input-label-left":e}};function G(o,u){if(1&o&&(t.TgZ(0,"div",5),t._uU(1),t.qZA()),2&o){const e=t.oxw();t.Q6J("ngClass",t.kEZ(3,R,!e.valid,"top"===e.labelPosition,"left"===e.labelPosition)),t.xp6(1),t.AsE(" ",e.label,"",e.required?"*":""," ")}}const Q=function(o){return{"calendar-height":o}};function z(o,u){if(1&o){const e=t.EpF();t.TgZ(0,"ion-datetime",6),t.NdJ("ionChange",function(a){t.CHM(e);const s=t.oxw();return t.KtG(s.selectDate(a))}),t.qZA(),t.TgZ(1,"div",7)(2,"div",8),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.closeModal())}),t._uU(3,"Cancel"),t.qZA(),t.TgZ(4,"div",9),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.submit())}),t._uU(5,"Submit"),t.qZA()()}if(2&o){const e=t.oxw();t.Q6J("value",e.formValue)("ngClass",t.VKq(4,Q,"date-time"===e.localType))("presentation",e.localType)("preferWheel",e.enableWheel)}}const W=function(o,u){return{"custom-input-top":o,"custom-input-left":u}},K=function(o,u,e,n,a){return{"input-fill":o,"validation-error":u,"input-left":e,"disable-form":n,"disable-input-opacity":a}};let j=(()=>{class o{constructor(e,n){this.utilityService=e,this.shareService=n,this.fill=!0,this.validators=[],this.noValidation=!1,this.required=!1,this.disabled=!1,this.showDisabled=!1,this.labelPosition="top",this.timeZone=Intl.DateTimeFormat().resolvedOptions().timeZone,this.value=0,this.emitValue=new t.vpe,this.validationChange=new t.vpe,this.valid=!0,this.isModalOpen=!1,this.id="",this.localType="date-time",this.enableWheel=!1,this.displayValue="",this.formValue="",this.previousValue="",this.previousDisplayValue="",this.timeZones={},this.chosenTimeDifference=0,this.seconds=0}set type(e){this.localType=e,"date-time"!==this.localType&&(this.enableWheel=!0)}get validation(){return this._validation}set validation(e){this._validation!==e&&(this._validation=e,this.validationChange.emit(e))}ngOnInit(){var e=this;return(0,p.Z)(function*(){e.validateSubscription=e.shareService.currentMessage.subscribe(n=>{"reset"===n?e.valid=!0:"invalidate"===n&&!e.noValidation&&(e.valid=!1)}),e.timeZones=e.utilityService.checkSeason(),e.id=e.utilityService.generateString(8),e.value?e.formValue=(0,i.p6)(e.value,"YYYY-MM-ddTHH:mm:ss","en_US",e.timeZones[e.timeZone]):(e.formValue=(0,i.p6)(new Date,"YYYY-MM-ddTHH:mm:ss","en_US",e.timeZones[e.timeZone]),e.value=new Date(e.formValue).getTime()),e.seconds=Math.floor(e.value%6e4/1e3),e.selectDate(e.convertValueWithTimeZone(e.value)),e.previousDisplayValue=e.displayValue,e.previousValue=e.formValue})()}ngOnDestroy(){this.validateSubscription.unsubscribe()}selectDate(e){switch(this.formValue="string"==typeof e?e:e.detail.value,this.localType){case"date-time":this.displayValue=(0,i.p6)(this.formValue,"LLL d'th', yyyy hh:mm a","en_US");break;case"date":this.displayValue=(0,i.p6)(this.formValue,"LLL d'th', yyyy","en_US");break;case"time":this.displayValue=(0,i.p6)(this.formValue,"hh:mm a","en_US").slice(0,5)+":"+this.seconds.toString().padStart(2,"0")+(0,i.p6)(this.formValue,"hh:mm a","en_US").slice(5)}}convertValue(e){return(0,i.p6)(e,"YYYY-MM-ddTHH:mm:ss","en_US")}convertValueWithTimeZone(e){return(0,i.p6)(e,"YYYY-MM-ddTHH:mm:ss","en_US",this.timeZones[this.timeZone])}openModal(){this.isModalOpen=!0}closeModal(){this.isModalOpen=!1,this.formValue=this.previousValue,this.displayValue=this.previousDisplayValue}submit(){this.isModalOpen=!1,this.previousValue=this.formValue,this.previousDisplayValue=this.displayValue,this.chosenTimeDifference=new Date(this.formValue).getTime()-new Date(this.convertValueWithTimeZone(this.value)).getTime(),this.emitValue.emit(this.value+this.chosenTimeDifference+1e3*this.seconds)}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(x.t),t.Y36(P.t))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-date-time"]],inputs:{label:"label",fill:"fill",validators:"validators",noValidation:"noValidation",required:"required",disabled:"disabled",showDisabled:"showDisabled",labelPosition:"labelPosition",timeZone:"timeZone",type:"type",value:"value",validation:"validation"},outputs:{emitValue:"emitValue",validationChange:"validationChange"},decls:7,vars:16,consts:[[1,"custom-input",3,"ngClass"],["class","input-label",3,"ngClass",4,"ngIf"],[1,"input-box",3,"id","ngClass","click"],[1,"input-box-value"],["id","custom-modal",3,"isOpen","trigger"],[1,"input-label",3,"ngClass"],[3,"value","ngClass","presentation","preferWheel","ionChange"],[1,"submit-buttons"],[1,"action-button","default",3,"click"],[1,"action-button","primary",2,"color","#fcfcfc",3,"click"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.YNc(1,G,2,7,"div",1),t.TgZ(2,"div",2),t.NdJ("click",function(){return n.openModal()}),t.TgZ(3,"div",3),t._uU(4),t.qZA()(),t.TgZ(5,"ion-modal",4),t.YNc(6,z,6,6,"ng-template"),t.qZA()()),2&e&&(t.Q6J("ngClass",t.WLB(7,W,"top"===n.labelPosition,"left"===n.labelPosition)),t.xp6(1),t.Q6J("ngIf",n.label),t.xp6(1),t.Q6J("id",n.id)("ngClass",t.qbA(10,K,n.fill,!n.valid,"left"===n.labelPosition,n.disabled,n.showDisabled)),t.xp6(2),t.Oqu(n.displayValue),t.xp6(1),t.Q6J("isOpen",n.isModalOpen)("trigger",n.id))},dependencies:[i.mk,i.O5,b.x4,b.ki,b.QI],styles:[".custom-input[_ngcontent-%COMP%]{width:100%;height:-moz-fit-content;height:fit-content}.custom-input-top[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:5px}.custom-input-left[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;align-items:center;gap:24px}.input-label[_ngcontent-%COMP%]{color:var(--gray-500)}.input-label-top[_ngcontent-%COMP%]{font-size:14px;font-weight:400}.input-label-left[_ngcontent-%COMP%]{flex:1;font-size:15px;font-weight:600}.input-box[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:15px;width:100%;height:45px;border-radius:10px;padding:10px 15px;font-size:14px;font-weight:400;color:var(--gray-500);border:1px solid var(--gray-200);background-position:right 15px center}.input-box[_ngcontent-%COMP%]   .input-box-value[_ngcontent-%COMP%]{flex:1 calc(92% - 15px);box-sizing:border-box;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.input-box[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{flex:1 8%;width:18px;height:18px}.input-fill[_ngcontent-%COMP%]{border:none!important;background-color:var(--gray-100)}.input-left[_ngcontent-%COMP%]{flex:1}.validation-error[_ngcontent-%COMP%]{border:1px solid var(--error-600)!important}.validation-error[_ngcontent-%COMP%]:focus{border:1px solid var(--error-600)!important}.label-error[_ngcontent-%COMP%]{color:var(--error-600)}ion-modal#custom-modal[_ngcontent-%COMP%]{--width: fit-content;--min-width: 80%;--max-height: 70%;--overflow: hidden;--height: fit-content;--border-radius: 10px;--box-shadow: 0 28px 48px rgba(0, 0, 0, .4)}.option-box[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%;padding:10px 0;overflow:auto;max-height:500px}.option-box[_ngcontent-%COMP%]   .select-option[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-between;align-items:center;padding:12px 20px;transition:all .2s}.option-box[_ngcontent-%COMP%]   .select-option[_ngcontent-%COMP%]:active{background-color:var(--gray-100)}.option-box[_ngcontent-%COMP%]   .select-option[_ngcontent-%COMP%]   .select-icon[_ngcontent-%COMP%]{display:flex;align-items:center}ion-checkbox[_ngcontent-%COMP%]{--size: 20px;--checkbox-background-checked: var(--success-500);--border-color: var(--gray-200);--checkbox-background: var(--gray-100);--border-color-checked: transparent;--checkmark-width: 2px;pointer-events:none}ion-checkbox[_ngcontent-%COMP%]::part(container){border-radius:50%}.submit-buttons[_ngcontent-%COMP%]{display:flex;align-items:center;gap:5px;width:100%;padding:10px 20px;border-top:1px solid var(--gray-100)}.submit-buttons[_ngcontent-%COMP%]   .action-button[_ngcontent-%COMP%]{flex:1;font-size:15px;display:flex;justify-content:center;align-items:center;padding:10px;border-radius:50px;cursor:pointer}.default[_ngcontent-%COMP%]{color:var(--gray-500);background-color:var(--gray-100)}.primary[_ngcontent-%COMP%]{color:var(--gray-25);background-color:var(--primary-600)}@media screen and (max-height: 799px){.option-box[_ngcontent-%COMP%]{max-height:400px}}@media screen and (max-height: 659px){.option-box[_ngcontent-%COMP%]{max-height:350px}}ion-datetime[_ngcontent-%COMP%]{padding:10px 20px;color:var(--gray-700);--background: var(--all-background);--background-rgb: var(--all-background);--ion-color-primary: var(--primary-600);--ion-color-step-150: var(--gray-150)}.calendar-height[_ngcontent-%COMP%]{height:330px!important;padding:10px 0 0!important}.disable-input-opacity[_ngcontent-%COMP%]{pointer-events:none}"]}),o})();var $=d(5960),X=d(7236),tt=d(2092);let et=(()=>{class o{transform(e){const n=Math.floor(e/1e3),a=Math.floor(n/3600),s=Math.floor(n%3600/60),l=n%60;return`${String(a).padStart(2,"0")}h ${String(s).padStart(2,"0")}min ${String(l).padStart(2,"0")}s`}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275pipe=t.Yjl({name:"convertMsToHoursAndMinutesAndSecondsHm",type:o,pure:!0}),o})();function nt(o,u){if(1&o){const e=t.EpF();t.TgZ(0,"app-header",4),t.NdJ("backButtonCallback",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.goBack())}),t.qZA()}if(2&o){const e=t.oxw();t.Q6J("title","Edit Duty Status")("subtitle",e.getCurrentDateFormat(null==e.logDaily?null:e.logDaily.logDate))("backButton",!0)}}function it(o,u){if(1&o&&(t.O4$(),t.TgZ(0,"g",74)(1,"g",75),t._UZ(2,"line",12),t.TgZ(3,"g",76),t._UZ(4,"line",77)(5,"line",78)(6,"line",79),t.qZA(),t.TgZ(7,"g",80),t._UZ(8,"line",77)(9,"line",78)(10,"line",79),t.qZA(),t.TgZ(11,"g",81),t._UZ(12,"line",82)(13,"line",83)(14,"line",84),t.qZA(),t.TgZ(15,"g",85),t._UZ(16,"line",82)(17,"line",83)(18,"line",84),t.qZA()()()),2&o){const e=u.$implicit;t.xp6(1),t.Udp("transform","translateX("+60*e+"px)")}}function at(o,u){if(1&o&&(t.O4$(),t._UZ(0,"line",88)),2&o){const e=t.oxw().$implicit;t.uIk("x1",e.x1)("x2",e.x1)("y1",e.y1)("y2",e.yV)}}function ot(o,u){if(1&o&&(t.O4$(),t.TgZ(0,"g",86),t._UZ(1,"line"),t.YNc(2,at,1,4,"line",87),t.qZA()),2&o){const e=u.$implicit;t.xp6(1),t.Tol(e.class),t.uIk("x1",e.x1)("x2",e.x2)("y1",e.y1)("y2",e.y2),t.xp6(1),t.Q6J("ngIf",e.yV>0)}}function st(o,u){if(1&o&&(t.O4$(),t.kcU(),t.TgZ(0,"div",89)(1,"span"),t._uU(2),t.qZA(),t.TgZ(3,"span"),t._uU(4),t.qZA()()),2&o){const e=t.oxw(2);t.xp6(2),t.hij("Min: ",e.minValue,""),t.xp6(2),t.hij("Max: ",e.maxValue,"")}}function lt(o,u){if(1&o){const e=t.EpF();t.TgZ(0,"div",92),t.NdJ("click",function(){const s=t.CHM(e).$implicit,l=t.oxw(3);return t.KtG(l.toggleViolationRect(s))}),t._uU(1),t.ALo(2,"date"),t.qZA()}if(2&o){const e=u.$implicit,n=t.oxw(3);t.xp6(1),t.AsE(" ",(null==e||null==e.regulations?null:e.regulations.name)+" ","",t.Dn7(2,2,null==e?null:e.startTime,"hh:mm:ss a",n.timeZones[n.timeZone])," ")}}function rt(o,u){if(1&o&&(t.O4$(),t.kcU(),t.TgZ(0,"div",90),t.YNc(1,lt,3,6,"div",91),t.qZA()),2&o){const e=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",e.violations[e.logDaily.logDate])}}function dt(o,u){1&o&&(t.TgZ(0,"span",93),t._uU(1,"Save"),t.qZA())}function ct(o,u){1&o&&t._UZ(0,"ion-spinner",94)}const A=function(o){return{"disable-click":o}};function ut(o,u){if(1&o){const e=t.EpF();t.TgZ(0,"div",5)(1,"div",6),t.O4$(),t.TgZ(2,"svg",7)(3,"g",8),t._UZ(4,"rect",9),t.YNc(5,it,19,2,"g",10),t.TgZ(6,"g",11),t._UZ(7,"line",12),t.qZA(),t._UZ(8,"line",13)(9,"line",14)(10,"line",15)(11,"line",16)(12,"line",17),t.qZA(),t.TgZ(13,"g",18)(14,"text",19),t._uU(15,"OFF"),t.qZA(),t.TgZ(16,"text",20),t._uU(17,"SB"),t.qZA(),t.TgZ(18,"text",21),t._uU(19,"D"),t.qZA(),t.TgZ(20,"text",22),t._uU(21,"ON"),t.qZA()(),t.TgZ(22,"g",23)(23,"text",24),t._uU(24,"M"),t.qZA(),t.TgZ(25,"text",25),t._uU(26,"1"),t.qZA(),t.TgZ(27,"text",26),t._uU(28,"2"),t.qZA(),t.TgZ(29,"text",27),t._uU(30,"3"),t.qZA(),t.TgZ(31,"text",28),t._uU(32,"4"),t.qZA(),t.TgZ(33,"text",29),t._uU(34,"5"),t.qZA(),t.TgZ(35,"text",30),t._uU(36,"6"),t.qZA(),t.TgZ(37,"text",31),t._uU(38,"7"),t.qZA(),t.TgZ(39,"text",32),t._uU(40,"8"),t.qZA(),t.TgZ(41,"text",33),t._uU(42,"9"),t.qZA(),t.TgZ(43,"text",34),t._uU(44,"10"),t.qZA(),t.TgZ(45,"text",35),t._uU(46,"11"),t.qZA(),t.TgZ(47,"text",36),t._uU(48,"N"),t.qZA(),t.TgZ(49,"text",37),t._uU(50,"1"),t.qZA(),t.TgZ(51,"text",38),t._uU(52,"2"),t.qZA(),t.TgZ(53,"text",39),t._uU(54,"3"),t.qZA(),t.TgZ(55,"text",40),t._uU(56,"4"),t.qZA(),t.TgZ(57,"text",41),t._uU(58,"5"),t.qZA(),t.TgZ(59,"text",42),t._uU(60,"6"),t.qZA(),t.TgZ(61,"text",43),t._uU(62,"7"),t.qZA(),t.TgZ(63,"text",44),t._uU(64,"8"),t.qZA(),t.TgZ(65,"text",45),t._uU(66,"9"),t.qZA(),t.TgZ(67,"text",46),t._uU(68,"10"),t.qZA(),t.TgZ(69,"text",47),t._uU(70,"11"),t.qZA(),t.TgZ(71,"text",48),t._uU(72,"M"),t.qZA()(),t.TgZ(73,"g",49)(74,"text",50),t._uU(75),t.ALo(76,"convertSecotdsToHoursAndMinutes"),t.qZA(),t.TgZ(77,"text",51),t._uU(78),t.ALo(79,"convertSecotdsToHoursAndMinutes"),t.qZA(),t.TgZ(80,"text",52),t._uU(81),t.ALo(82,"convertSecotdsToHoursAndMinutes"),t.qZA(),t.TgZ(83,"text",53),t._uU(84),t.ALo(85,"convertSecotdsToHoursAndMinutes"),t.qZA()(),t.TgZ(86,"g",54),t.YNc(87,ot,3,7,"g",55),t.qZA(),t.TgZ(88,"g",56),t._UZ(89,"rect",57),t.qZA(),t.TgZ(90,"g",56),t._UZ(91,"rect",58),t.qZA()(),t.YNc(92,st,5,2,"div",59),t.YNc(93,rt,2,1,"div",60),t.qZA(),t.kcU(),t.TgZ(94,"div",61)(95,"app-date-time",62),t.NdJ("emitValue",function(a){t.CHM(e);const s=t.oxw();return t.KtG(s.getNewStartDate(a))}),t.qZA(),t._UZ(96,"app-input",63),t.ALo(97,"convertMsToHoursAndMinutesAndSecondsHm"),t.qZA(),t.TgZ(98,"div",64)(99,"app-duty-radio-button",65),t.NdJ("selectedValue",function(a){t.CHM(e);const s=t.oxw();return t.KtG(s.selectButton(a))}),t.qZA()(),t.TgZ(100,"div",66)(101,"app-location-input",67),t.NdJ("valueChange",function(a){t.CHM(e);const s=t.oxw();return t.KtG(s.logEvent.location.description=a)})("gpsCallback",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.getLocalCurrentLocation())}),t.qZA(),t.TgZ(102,"app-comments",68),t.NdJ("valueChange",function(a){t.CHM(e);const s=t.oxw();return t.KtG(s.logEvent.comment=a)}),t.qZA()(),t.TgZ(103,"div",69)(104,"button",70),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.goBack())}),t._uU(105,"Back"),t.qZA(),t.TgZ(106,"button",71),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.save())}),t.YNc(107,dt,2,0,"span",72),t.YNc(108,ct,1,0,"ion-spinner",73),t.qZA()()()}if(2&o){const e=t.oxw();t.xp6(5),t.Q6J("ngForOf",e.graphicsHour),t.xp6(70),t.Oqu(t.lcZ(76,52,60*e.durationsOFF)),t.xp6(3),t.Oqu(t.lcZ(79,54,60*e.durationsSB)),t.xp6(3),t.Oqu(t.lcZ(82,56,60*e.durationsD)),t.xp6(3),t.Oqu(t.lcZ(85,58,60*e.durationsON)),t.xp6(3),t.Q6J("ngForOf",e.eventGraphicLine),t.xp6(2),t.uIk("x",e.currentLogEventRect.x1)("width",e.currentLogEventRect.x2-e.currentLogEventRect.x1),t.xp6(2),t.uIk("x",e.violationRect.x1)("width",e.violationRect.x2-e.violationRect.x1),t.xp6(1),t.Q6J("ngIf",!e.disableForm.timeInput),t.xp6(1),t.Q6J("ngIf",e.violations[e.logDaily.logDate]&&0!==e.violations[e.logDaily.logDate].length),t.xp6(2),t.Q6J("label","Start Time ("+e.timeZone+")")("fill",!0)("labelPosition","top")("disabled",e.disableForm.timeInput)("showDisabled",e.disableForm.timeInput)("type","time")("timeZone",e.timeZone)("value",e.logEvent.eventTime.timeStamp)("validation",e.validation.startTime),t.xp6(1),t.Q6J("label","Duration")("fill",!0)("disabled",!0)("showDisabled",!0)("labelPosition","top")("type","text")("value",t.lcZ(97,60,e.duration))("validation",e.validation.startTime),t.xp6(3),t.Q6J("disable",e.disableForm.status)("showDisabled",e.disableForm.status)("currentValue",e.selectedButton),t.xp6(2),t.Q6J("label","Location")("disabled",e.disableForm.location)("showDisabled",e.disableForm.location)("fill",!0)("labelPosition","top")("type","text")("loading",e.locationLoading)("value",e.logEvent.location.description)("validation",e.validation.location)("noValidation",e.noValidation),t.xp6(1),t.Q6J("label","Comments")("fill",!0)("type","text")("value",e.logEvent.comment)("validation",e.validation.comments)("noValidation",e.noValidation),t.xp6(2),t.Q6J("ngClass",t.VKq(62,A,e.loading)),t.xp6(2),t.Q6J("ngClass",t.VKq(64,A,e.loading)),t.xp6(1),t.Q6J("ngIf",!e.loading),t.xp6(1),t.Q6J("ngIf",e.loading)}}function gt(o,u){1&o&&t._UZ(0,"app-page-loader",95),2&o&&t.Q6J("height","100%")}const mt=[{path:"",component:(()=>{class o{constructor(e,n,a,s,l,r,g,v,m){this.navCtrl=e,this.route=n,this.utilityService=a,this.storage=s,this.databaseService=l,this.toastService=r,this.shareService=g,this.dashboardService=v,this.locationService=m,this.selectedButton="",this.currentStatus="",this.currentDay="",this.logDailies=[],this.statusesOnDay=[],this._statusesOnDay=[],this.oldStatusesOnDay=[],this.logEvents=[],this.graphicsHour=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],this.eventGraphicLine=[],this.pageLoading=!1,this.timeZones={},this.timeZone="",this.durationsOFF=0,this.durationsSB=0,this.durationsD=0,this.durationsON=0,this.duration=0,this.validation={startTime:!0,location:!1,comments:!1},this.noValidation=!1,this.disableForm={timeInput:!1,status:!1,location:!1},this.onInitExec=!0,this.currentLogEventRect={x1:0,x2:0},this.minValue="",this.minValueNumber=0,this.maxValue="",this.maxValueNumber=0,this.timeZoneDifference=0,this.loading=!1,this.locationLoading=!1,this.locationDisable=!1,this.violations={},this.newShift=36e6,this.driveLimit=396e5,this.shiftLimit=504e5,this.cycleLimit=252e6,this.driveWithoutBreakLimit=288e5,this.restartTime=1224e5,this.notDriveLimit=18e5,this.inspectionTime=6912e5,this.violationRect={x1:0,x2:0},this.dutyStatuses=[{label:"Off Duty",value:"OFF"},{label:"Sleeper Berth",value:"SB"},{label:"On Duty",value:"ON"},{label:"Driving",value:"D"},{label:"Personal Conveyance",value:"PC"},{label:"Yard Moves",value:"YM"}]}ngOnInit(){var e=this;return(0,p.Z)(function*(){e.pageLoading=!0,e.timeZones=e.utilityService.checkSeason();let n=(0,y.z)(e.databaseService.getLogDailies()),a=(0,y.z)(e.databaseService.getLogEvents()),s=(0,y.z)(e.route.queryParams),l=e.storage.get("timeZone"),r=e.storage.get("splitSleeperBerth");(0,Z.D)([s,l,n,a,r]).subscribe(([g,v,m,_,w])=>{e.timeZone=v,e.splitSleeperBerth=w,e.logDailies=m,e.logDailyId=g.logDailyId,e.logDaily=e.logDailies.find(f=>f.logDailyId===g.logDailyId),e.violations[e.logDaily.logDate]=JSON.parse(JSON.stringify(e.logDaily.violations)),e.logEvents=_,e.logEvent=e.logEvents.find(f=>f.logEventId===g.logEventId),e.calculateDuration(),e.calculateTimeZoneDifference(),e.currentStatus=e.logEvent.type.code,e.selectButton(e.logEvent.type.code),e.drawGraph(),e.pageLoading=!1})})()}ngOnDestroy(){}goBack(){this.navCtrl.navigateBack(["log-item",this.logDailyId])}getLocalCurrentLocation(){var e=this;return(0,p.Z)(function*(){e.locationLoading=!0;let n=yield e.storage.get("locationStatus");"web"!==D.dV.getPlatform()&&(n||e.toastService.showToast("Problems fetching location! Check the location service!","danger",2500)),yield e.locationService.getCurrentLocation().then(a=>{let s=e.logEvent.location;e.logEvent.location=a,e.locationLoading=!1,"AUTOMATIC"===e.logEvent.location.locationType?e.locationDisable=!0:(e.locationDisable=!1,e.logEvent.location=s)})})()}drawGraph(){var e;const n=["OFF","SB","D","ON","PC","YM"];this.eventGraphicLine=[],this.statusesOnDay=[];let a=null,s=null,l="";this.xBgn=0,this.xEnd=0,this.xBgnV=0,this.yBgnV=0,this.durationsOFF=0,this.durationsSB=0,this.durationsD=0,this.durationsON=0,this.currentDay=null===(e=this.logDaily)||void 0===e?void 0:e.logDate,this.logEvents.forEach(r=>{if(n.includes(r.type.code)&&(l=r.eventTime.timeStampEnd?new Date(r.eventTime.timeStampEnd):(new Date).getTime(),a=new Date((0,i.p6)(new Date(r.eventTime.timeStamp),"yyyy-MM-dd HH:mm:ss","en_US",this.timeZones[this.timeZone])),s=new Date((0,i.p6)(new Date(l),"yyyy-MM-dd HH:mm:ss","en_US",this.timeZones[this.timeZone])),(0,i.p6)(new Date(r.eventTime.timeStamp),"yyyy-MM-dd","en_US",this.timeZones[this.timeZone])<=(0,i.p6)(new Date(this.currentDay),"yyyy-MM-dd","en_US")&&(0,i.p6)(new Date(this.currentDay),"yyyy-MM-dd","en_US")<=(0,i.p6)(new Date(l),"yyyy-MM-dd","en_US",this.timeZones[this.timeZone]))){switch(this.xBgn=a.toLocaleDateString()===new Date(this.currentDay).toLocaleDateString()?60*a.getHours()+a.getMinutes():0,this.xEnd=s.toLocaleDateString()===new Date(this.currentDay).toLocaleDateString()?60*s.getHours()+s.getMinutes():1440,r.type.code){case"OFF":case"PC":this.yBgn=25,this.yEnd=25,this.durationsOFF+=this.xEnd-this.xBgn;break;case"SB":this.yBgn=75,this.yEnd=75,this.durationsSB+=this.xEnd-this.xBgn;break;case"D":this.yBgn=125,this.yEnd=125,this.durationsD+=this.xEnd-this.xBgn;break;case"ON":case"YM":this.yBgn=175,this.yEnd=175,this.durationsON+=this.xEnd-this.xBgn}switch(r.type.code){case"OFF":this.eventGraphicLine.push({x1:this.xBgn,y1:this.yBgn,x2:this.xEnd,y2:this.yEnd,yV:this.yBgnV,class:"eventStatusOFF",name:"",historyId:r.logEventId,status:0,statusClick:0});break;case"SB":this.eventGraphicLine.push({x1:this.xBgn,y1:this.yBgn,x2:this.xEnd,y2:this.yEnd,yV:this.yBgnV,class:"eventStatusSB",name:"",historyId:r.logEventId,status:0,statusClick:0});break;case"D":this.eventGraphicLine.push({x1:this.xBgn,y1:this.yBgn,x2:this.xEnd,y2:this.yEnd,yV:this.yBgnV,class:"eventStatusD",name:"",historyId:r.logEventId,status:0,statusClick:0});break;case"ON":this.eventGraphicLine.push({x1:this.xBgn,y1:this.yBgn,x2:this.xEnd,y2:this.yEnd,yV:this.yBgnV,class:"eventStatusON",name:"",historyId:r.logEventId,status:0,statusClick:0});break;case"PC":this.eventGraphicLine.push({x1:this.xBgn,y1:this.yBgn,x2:this.xEnd,y2:this.yEnd,yV:this.yBgnV,class:"eventStatusPC",name:"",historyId:r.logEventId,status:0,statusClick:0});break;case"YM":this.eventGraphicLine.push({x1:this.xBgn,y1:this.yBgn,x2:this.xEnd,y2:this.yEnd,yV:this.yBgnV,class:"eventStatusYM",name:"",historyId:r.logEventId,status:0,statusClick:0})}this.xBgnV=this.xEnd,this.yBgnV=this.yEnd,this.statusesOnDay.push(r)}}),this._statusesOnDay=JSON.parse(JSON.stringify(this.statusesOnDay)),this.displayCurrentLogEventRect(),this.onInitExec&&(this.disableWhenDrivingFromELD(),this.calculateMinAndMaxValues(),this.onInitExec=!1),this.validation.startTime?(this.oldStatusesOnDay=JSON.parse(JSON.stringify(this._statusesOnDay)),this.oldLogEvent=JSON.parse(JSON.stringify(this.logEvent))):(this._statusesOnDay=JSON.parse(JSON.stringify(this.oldStatusesOnDay)),this.logEvent=JSON.parse(JSON.stringify(this.oldLogEvent)))}save(){var e=this;return(0,p.Z)(function*(){if(e.logDaily.violations=e.violations[e.logDaily.logDate]?JSON.parse(JSON.stringify(e.violations[e.logDaily.logDate])):[],e.noValidation=!1,!e.validation.startTime)return void e.toastService.showToast("Start Time not valid!");if(e.logEvent.location.description&&0!==e.logEvent.location.description.length&&(e.validation.location=!0),e.logEvent.comment&&0!==e.logEvent.comment.length&&(e.validation.comments=!0),e.shareService.changeMessage(e.utilityService.generateString(5)),console.log(e.validation),!e.utilityService.validateForm(e.validation))return;e.loading=!0;let n=e._statusesOnDay.findIndex(s=>s.logEventId===e.logEvent.logEventId),a=e.logDailies.findIndex(s=>s.logDailyId===e.logDaily.logDailyId);n===e._statusesOnDay.length-1&&a===e.logDailies.length-1&&(e.logEvent.eventTime.timeStampEnd=void 0),yield e.updateLogDailies(e.logDaily),(yield M.Z.getStatus()).connected?(yield e.dashboardService.updateLogEvent(e.logEvent).toPromise().then(function(){var s=(0,p.Z)(function*(l){console.log("Last LogEvent is updated on server:",l),yield e.updateIndexLogEvents(e.logEvent,!0)});return function(l){return s.apply(this,arguments)}}()).catch(function(){var s=(0,p.Z)(function*(l){console.log("Last LogEvent Pushed in offline logEvents array"),yield e.updateIndexLogEvents(e.logEvent,!1)});return function(l){return s.apply(this,arguments)}}()),yield e.dashboardService.updateLogEvent(e._statusesOnDay[n-1]).toPromise().then(function(){var s=(0,p.Z)(function*(l){console.log("Last LogEvent is updated on server:",l),yield e.updateIndexLogEvents(e._statusesOnDay[n-1],!0),e.loading=!1,e.goBack()});return function(l){return s.apply(this,arguments)}}()).catch(function(){var s=(0,p.Z)(function*(l){console.log("Last LogEvent Pushed in offline logEvents array"),yield e.updateIndexLogEvents(e._statusesOnDay[n-1],!1),e.loading=!1,e.goBack()});return function(l){return s.apply(this,arguments)}}())):(console.log("Updated logEvents in offline array"),yield e.updateIndexLogEvents(e.logEvent,!1),yield e.updateIndexLogEvents(e._statusesOnDay[n-1],!1),e.loading=!1,e.goBack())})()}updateLogEvents(e,n){var a=this;return(0,p.Z)(function*(){e.sent=n,a.logEvents.push(e),yield a.storage.set("logEvents",a.logEvents)})()}updateIndexLogEvents(e,n){var a=this;return(0,p.Z)(function*(){e.sent=n;const s=a.logEvents.findIndex(l=>l.logEventId===e.logEventId);-1!==s&&(a.logEvents[s]=e),yield a.storage.set("logEvents",a.logEvents)})()}getNewStartDate(e){var n=this;return(0,p.Z)(function*(){n.clearRect();const a=6e4;(!n.logEvent.eventTime.timeStampEnd||n.logEvent.eventTime.timeStampEnd&&0===n.logEvent.eventTime.timeStampEnd)&&(n.logEvent.eventTime.timeStampEnd=(new Date).getTime()),e>n.logEvent.eventTime.timeStampEnd+a&&n.toastService.showToast("Log Start Time cannot be bigger than End Time","danger",3e3);const s=!(n.logEvent.eventTime.timeStamp-e>0);let l=n._statusesOnDay.findIndex(r=>r.logEventId===n.logEvent.logEventId);s?l===n._statusesOnDay.length-1?(n.maxValueNumber-e<=a?(n.validation.startTime=!1,n.invalidate(),n.toastService.showToast("Last log event must be at least 1 minute long","danger",2500)):(n.validation.startTime=!0,n.validate()),n.logEvent.eventTime.timeStamp=e,n._statusesOnDay[l].eventTime.timeStamp=e,n._statusesOnDay[l-1].eventTime.timeStampEnd=e,n.calculateDuration()):((new Date).getTime()-e<=a?(n.validation.startTime=!1,n.invalidate(),n.toastService.showToast("Current log event must be at least 1 minute long","danger",2500)):(n.validation.startTime=!0,n.validate()),n.logEvent.eventTime.timeStamp=e,n._statusesOnDay[l].eventTime.timeStamp=e,n._statusesOnDay[l-1].eventTime.timeStampEnd=e,n.calculateDuration()):(l-1==0?e-n.minValueNumber<=a?(n.validation.startTime=!1,n.invalidate(),n.toastService.showToast("First log event of the day must be at least 1 minute long","danger",2500)):(n.validation.startTime=!0,n.validate()):e-n._statusesOnDay[l-1].eventTime.timeStamp<=a?(n.validation.startTime=!1,n.invalidate(),n.toastService.showToast("Previous log event must be at least 1 minute long","danger",2500)):(n.validation.startTime=!0,n.validate()),n.logEvent.eventTime.timeStamp=e,n._statusesOnDay[l].eventTime.timeStamp=e,n._statusesOnDay[l-1].eventTime.timeStampEnd=e,n.calculateDuration()),n.logEvents=n.logEvents.map(r=>{const g=n._statusesOnDay.findIndex(v=>r.logEventId===v.logEventId);return-1===g?r:JSON.parse(JSON.stringify(n._statusesOnDay[g]))}),n.drawGraph(),yield n.calcViolations()})()}disableWhenDrivingFromELD(){let e=this._statusesOnDay.findIndex(n=>n.logEventId===this.logEvent.logEventId);"D"===this.logEvent.type.code&&"AUTO"===this.logEvent.recordOrigin.code&&(this.disableForm={timeInput:!0,status:!0,location:!0},this.toastService.showToast("Cannot change a Driving log event by ELD","warning",3e3)),"D"===this._statusesOnDay[e-1].type.code&&"AUTO"===this._statusesOnDay[e-1].recordOrigin.code&&(this.disableForm={timeInput:!0,status:!1,location:!1},this.toastService.showToast("Cannot change Start time of a log event next to a Driving event by ELD","warning",3e3))}invalidate(){this.noValidation=!0,setTimeout(()=>this.shareService.changeMessage("invalidate"),0)}validate(){this.shareService.changeMessage("reset")}calculateDuration(){this.duration=!this.logEvent.eventTime.timeStampEnd||this.logEvent.eventTime.timeStampEnd&&0===this.logEvent.eventTime.timeStampEnd?(new Date).getTime()-this.logEvent.eventTime.timeStamp:this.logEvent.eventTime.timeStampEnd-this.logEvent.eventTime.timeStamp}calculateMinAndMaxValues(){let e=this._statusesOnDay.findIndex(n=>n.logEventId===this.logEvent.logEventId);e-1==0?(this.minValue=this.getHours(new Date(this.logEvent.eventTime.logDate).setHours(0,0,0,0)+6e4),this.minValueNumber=new Date(this.logEvent.eventTime.logDate).setHours(0,0,0,0)+this.timeZoneDifference):this.minValue=this.getHoursByTimezone(this._statusesOnDay[e-1].eventTime.timeStamp+6e4),e===this._statusesOnDay.length-1?this.logEvent.eventTime.timeStampEnd?(this.maxValue=this.getHours(new Date(this.logEvent.eventTime.logDate).setHours(23,59,0,0)),this.maxValueNumber=new Date(this.logEvent.eventTime.logDate).setHours(23,59,0,0)+this.timeZoneDifference):(this.maxValue=this.getHoursByTimezone((new Date).getTime()),this.maxValueNumber=(new Date).getTime(),console.log(this.maxValue),console.log(this.maxValueNumber)):this.maxValue=this.getHoursByTimezone(this._statusesOnDay[e].eventTime.timeStampEnd-6e4)}selectButton(e){var n=this;return(0,p.Z)(function*(){n.selectedButton=e;let a=n.dutyStatuses.find(l=>l.value===e);n.logEvent.type.code=a.value,n.logEvent.type.name=a.label;let s=n.logEvents.findIndex(l=>l.logEventId===n.logEvent.logEventId);console.log(n.logEvent),n.logEvents[s]=n.logEvent,n.drawGraph(),yield n.calcViolations()})()}getCurrentDateFormat(e){return"("+(0,i.p6)(e,"LLLL d","en_US")+")"}getHours(e){return(0,i.p6)(e,"hh:mm:ss a","en_US")}getDate(e){return(0,i.p6)(e,"YYYY-MM-ddTHH:mm:ss","en_US")}getDateWithTimezone(e){return(0,i.p6)(e,"YYYY-MM-ddTHH:mm:ss","en_US",this.timeZones[this.timeZone])}getHoursByTimezone(e){return(0,i.p6)(e,"hh:mm:ss a","en_US",this.timeZones[this.timeZone])}calculateTimeZoneDifference(){this.timeZoneDifference=new Date(this.logEvent.eventTime.logDate).getTime()-new Date(this.getDateWithTimezone(new Date(this.logEvent.eventTime.logDate).getTime())).getTime()}displayCurrentLogEventRect(){try{let e=this.eventGraphicLine.findIndex(n=>n.historyId===this.logEvent.logEventId);this.currentLogEventRect.x1=this.eventGraphicLine[e].x1,this.currentLogEventRect.x2=this.eventGraphicLine[e].x2}catch(e){console.log(e)}}calcViolations(){var e=this;return(0,p.Z)(function*(){e.clearRect(),e.bResetTimeLast7Day=!1;const n=["OFF","SB","D","ON","PC","YM"];e.violations={};let v,m,a=0,s=0,l=0,r=0,g=0,_=0;e.splitSleepData=void 0;let w=JSON.parse(JSON.stringify(e.logEvents)),f=0;w.forEach((L,Mt)=>{var B,V;if("ACTIVE"===(null===(B=L.recordStatus)||void 0===B?void 0:B.code)&&n.includes(null===(V=L.type)||void 0===V?void 0:V.code)){switch(v=JSON.parse(JSON.stringify(L)),m=JSON.parse(JSON.stringify(L)),m.eventTime.timeStamp=L.eventTime.timeStampEnd?JSON.parse(JSON.stringify(L.eventTime.timeStampEnd)):(new Date).getTime(),f=m.eventTime.timeStamp-v.eventTime.timeStamp,v.type.code){case"OFF":case"SB":case"PC":if(a+=f,r+=f,_+=f,e.splitSleeperBerth&&("SB"===v.type.code||"OFF"===v.type.code)&&f>=72e5&&f<e.newShift){let T=Math.trunc(f/1e3/60/60),E=2;T>=2&&T<3?E=2:T>=3&&T<7?E=3:T>=3&&T<8&&"SB"===v.type.code?E=7:"SB"===v.type.code&&(E=8),(E>=7&&"SB"===v.type.code||E<7&&T<7)&&(r-=f,!e.splitSleepData&&r?e.splitSleepData={duration:E,time:r,drivingT:s}:e.splitSleepData&&r&&E+e.splitSleepData.duration>=10&&(r-=e.splitSleepData.time,s-=e.splitSleepData.drivingT,e.splitSleepData={duration:E,time:r,drivingT:s}))}if(a>=e.newShift&&(s=0,r=0,e.splitSleepData=void 0),a>=e.restartTime){r=0,g=0,s=0,e.splitSleepData=void 0;let T=new Date(e.logDailies[7].logDate).getTime();m.eventTime.timeStamp>T&&(e.bResetTimeLast7Day=!0)}break;case"ON":case"YM":a=0,_+=f,r+=f,g+=f,r>e.shiftLimit&&(e.pushViolation((0,i.p6)(new Date(m.eventTime.timeStamp-(r-e.shiftLimit)),"yyyy/MM/dd","en-US",e.timeZones[e.timeZone]),S.B.DUTY_LIMIT,m.eventTime.timeStamp-(r-e.shiftLimit)),r=0),g>e.cycleLimit&&(e.pushViolation((0,i.p6)(new Date(m.eventTime.timeStamp-(g-e.cycleLimit)),"yyyy/MM/dd","en-US",e.timeZones[e.timeZone]),S.B.US_70_8,m.eventTime.timeStamp-(g-e.cycleLimit)),g=0);break;case"D":a=0,l+=f,s+=f,r+=f,g+=f,l>e.driveWithoutBreakLimit&&_<e.notDriveLimit&&e.pushViolation((0,i.p6)(new Date(m.eventTime.timeStamp-(l-e.driveWithoutBreakLimit)),"yyyy/MM/dd","en-US",e.timeZones[e.timeZone]),S.B.REST_BREAK,m.eventTime.timeStamp-(l-e.driveWithoutBreakLimit)),s>e.driveLimit&&(e.pushViolation((0,i.p6)(new Date(m.eventTime.timeStamp-(s-e.driveLimit)),"yyyy/MM/dd","en-US",e.timeZones[e.timeZone]),S.B.DRIVING,m.eventTime.timeStamp-(s-e.driveLimit)),s=0),r>e.shiftLimit&&(e.pushViolation((0,i.p6)(new Date(m.eventTime.timeStamp-(r-e.shiftLimit)),"yyyy/MM/dd","en-US",e.timeZones[e.timeZone]),S.B.DUTY_LIMIT,m.eventTime.timeStamp-(r-e.shiftLimit)),r=0),g>e.cycleLimit&&(e.pushViolation((0,i.p6)(new Date(m.eventTime.timeStamp-(g-e.cycleLimit)),"yyyy/MM/dd","en-US",e.timeZones[e.timeZone]),S.B.US_70_8,m.eventTime.timeStamp-(g-e.cycleLimit)),g=0),_=0}_>=e.notDriveLimit&&(_=0,l=0)}}),console.log(e.violations)})()}pushViolation(e,n,a){let s={startTime:a,timeZone:"",regulations:{code:n.code,name:n.name}};this.violations[e]?this.violations[e].push(s):this.violations[e]=[s]}clearRect(){this.violationRect.x1=0,this.violationRect.x2=0}toggleViolationRect(e){try{var n,a;const s=["OFF","SB","D","ON","PC","YM"];let g,v,m,_,l=this.logEvents.findIndex(w=>w.eventTime.timeStamp>e.startTime&&s.includes(w.type.code)),r=new Date((0,i.p6)(new Date(e.startTime),"yyyy-MM-dd HH:mm:ss","en_US",this.timeZones[this.timeZone]));g=null!==(n=this.logEvents[l])&&void 0!==n&&null!==(a=n.eventTime)&&void 0!==a&&a.timeStamp?new Date(this.logEvents[l].eventTime.timeStamp):new Date,v=new Date((0,i.p6)(new Date(g),"yyyy-MM-dd HH:mm:ss","en_US",this.timeZones[this.timeZone])),m=(0,i.p6)(r,"yyyy/MM/dd","en_US")===(0,i.p6)(this.currentDay,"yyyy/MM/dd","en_US")?60*r.getHours()+r.getMinutes():0,_=(0,i.p6)(v,"yyyy/MM/dd","en_US")===(0,i.p6)(this.currentDay,"yyyy/MM/dd","en_US")?60*v.getHours()+v.getMinutes():1440,this.violationRect.x1=m,this.violationRect.x2=_}catch(s){console.log(s)}}updateLogDailies(e){var n=this;return(0,p.Z)(function*(){(yield M.Z.getStatus()).connected?yield(0,y.z)(n.dashboardService.updateLogDaily(e)).then(function(){var a=(0,p.Z)(function*(s){console.log("LogDaily (durationStatuses) is updated on server:",s),yield n.updateIndexLogDaily(e,!0)});return function(s){return a.apply(this,arguments)}}()).catch(function(){var a=(0,p.Z)(function*(s){yield n.updateIndexLogDaily(e,!1),console.log("Pushed in logDailies")});return function(s){return a.apply(this,arguments)}}()):(console.log("Updated logEvents in offline array"),yield n.updateIndexLogDaily(e,!1))})()}updateIndexLogDaily(e,n){var a=this;return(0,p.Z)(function*(){e.sent=n;const s=a.logDailies.findIndex(l=>l.logDailyId===e.logDailyId);-1!==s&&(a.logDailies[s]=e),yield a.storage.set("logDailies",a.logDailies)})()}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(b.SH),t.Y36(O.gz),t.Y36(x.t),t.Y36(c.K),t.Y36(h.k),t.Y36(I.k),t.Y36(P.t),t.Y36(N.s),t.Y36(J.a))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-edit-duty-status"]],decls:4,vars:5,consts:[[3,"fullscreen","forceOverscroll"],[3,"title","subtitle","backButton","backButtonCallback",4,"ngIf"],["class","padding-g","style","display: flex; flex-direction: column; gap: 20px",4,"ngIf"],[3,"height",4,"ngIf"],[3,"title","subtitle","backButton","backButtonCallback"],[1,"padding-g",2,"display","flex","flex-direction","column","gap","20px"],[1,"card-info"],["preserveAspectRatio","xMidYMid","viewBox","0 0 1600 270"],["transform","translate(65, 40)",1,"grid"],["x","0","y","0","width","1440","height","200","rx","8","ry","8",1,"border"],["class","",4,"ngFor","ngForOf"],["transform","translate(1440, 0)",1,"column"],["x1","0","x2","0","y1","0","y2","200"],["x1","0","x2","1440","y1","0","y2","0",1,"row"],["x1","0","x2","1440","y1","50","y2","50",1,"row"],["x1","0","x2","1440","y1","100","y2","100",1,"row"],["x1","0","x2","1440","y1","150","y2","150",1,"row"],["x1","0","x2","1440","y1","200","y2","200",1,"row"],["transform","translate(35, 40)",1,"duty-status-labels"],["transform","translate(15, 25)","text-anchor","end","dy","0.35em",1,"label"],["transform","translate(15, 75)","text-anchor","end","dy","0.35em",1,"label"],["transform","translate(15, 125)","text-anchor","end","dy","0.35em",1,"label"],["transform","translate(15, 175)","text-anchor","end","dy","0.35em",1,"label"],["transform","translate(65, 40)",1,"hour-labels"],["transform","translate(0, 10)","text-anchor","middle","dy","-1em",1,"label"],["transform","translate(60, 10)","text-anchor","middle","dy","-1em",1,"label"],["transform","translate(120, 10)","text-anchor","middle","dy","-1em",1,"label"],["transform","translate(180, 10)","text-anchor","middle","dy","-1em",1,"label"],["transform","translate(240, 10)","text-anchor","middle","dy","-1em",1,"label"],["transform","translate(300, 10)","text-anchor","middle","dy","-1em",1,"label"],["transform","translate(360, 10)","text-anchor","middle","dy","-1em",1,"label"],["transform","translate(420, 10)","text-anchor","middle","dy","-1em",1,"label"],["transform","translate(480, 10)","text-anchor","middle","dy","-1em",1,"label"],["transform","translate(540, 10)","text-anchor","middle","dy","-1em",1,"label"],["transform","translate(600, 10)","text-anchor","middle","dy","-1em",1,"label"],["transform","translate(660, 10)","text-anchor","middle","dy","-1em",1,"label"],["transform","translate(720, 10)","text-anchor","middle","dy","-1em",1,"label"],["transform","translate(780, 10)","text-anchor","middle","dy","-1em",1,"label"],["transform","translate(840, 10)","text-anchor","middle","dy","-1em",1,"label"],["transform","translate(900, 10)","text-anchor","middle","dy","-1em",1,"label"],["transform","translate(960, 10)","text-anchor","middle","dy","-1em",1,"label"],["transform","translate(1020, 10)","text-anchor","middle","dy","-1em",1,"label"],["transform","translate(1080, 10)","text-anchor","middle","dy","-1em",1,"label"],["transform","translate(1140, 10)","text-anchor","middle","dy","-1em",1,"label"],["transform","translate(1200, 10)","text-anchor","middle","dy","-1em",1,"label"],["transform","translate(1260, 10)","text-anchor","middle","dy","-1em",1,"label"],["transform","translate(1320, 10)","text-anchor","middle","dy","-1em",1,"label"],["transform","translate(1380, 10)","text-anchor","middle","dy","-1em",1,"label"],["transform","translate(1440, 10)","text-anchor","middle","dy","-1em",1,"label"],["transform","translate(1520, 40)",1,"durations"],["transform","translate(0, 25)","dy","0.35em",1,"label"],["transform","translate(0, 75)","dy","0.35em",1,"label"],["transform","translate(0, 125)","dy","0.35em",1,"label"],["transform","translate(0, 175)","dy","0.35em",1,"label"],["transform","translate(65, 40)",1,"eventLine"],["class","eventRecord",4,"ngFor","ngForOf"],["transform","translate(65, 40)"],["height","200",1,"current-status"],["height","200",1,"error-status-viol"],["class","range-container",4,"ngIf"],["class","violation-list",4,"ngIf"],[1,"time-inputs"],[3,"label","fill","labelPosition","disabled","showDisabled","type","timeZone","value","validation","emitValue"],[3,"label","fill","disabled","showDisabled","labelPosition","type","value","validation"],[1,"status-change"],[3,"disable","showDisabled","currentValue","selectedValue"],[1,"location-comments"],[3,"label","disabled","showDisabled","fill","labelPosition","type","loading","value","validation","noValidation","valueChange","gpsCallback"],[3,"label","fill","type","value","validation","noValidation","valueChange"],[1,"confirm-buttons"],[1,"custom-btn","secondary-btn",3,"ngClass","click"],[1,"custom-btn","primary-btn",3,"ngClass","click"],["style","color: #fcfcfc",4,"ngIf"],["name","circular","color","light","class","spinner",4,"ngIf"],[1,""],[1,"column"],["transform","translate(0, 0)",1,"cell","top"],["x1","15","x2","15","y1","0","y2","17.5"],["x1","30","x2","30","y1","0","y2","35"],["x1","45","x2","45","y1","0","y2","17.5"],["transform","translate(0, 50)",1,"cell","top"],["transform","translate(0, 100)",1,"cell","bottom"],["x1","15","x2","15","y1","50","y2","32.5"],["x1","30","x2","30","y1","50","y2","15"],["x1","45","x2","45","y1","50","y2","32.5"],["transform","translate(0, 150)",1,"cell","bottom"],[1,"eventRecord"],["class","vertical",4,"ngIf"],[1,"vertical"],[1,"range-container"],[1,"violation-list"],["class","violation-item",3,"click",4,"ngFor","ngForOf"],[1,"violation-item",3,"click"],[2,"color","#fcfcfc"],["name","circular","color","light",1,"spinner"],[3,"height"]],template:function(e,n){1&e&&(t.TgZ(0,"ion-content",0),t.YNc(1,nt,1,3,"app-header",1),t.YNc(2,ut,109,66,"div",2),t.YNc(3,gt,1,1,"app-page-loader",3),t.qZA()),2&e&&(t.Q6J("fullscreen",!0)("forceOverscroll",!1),t.xp6(1),t.Q6J("ngIf",!n.pageLoading),t.xp6(1),t.Q6J("ngIf",!n.pageLoading),t.xp6(1),t.Q6J("ngIf",n.pageLoading))},dependencies:[i.mk,i.sg,i.O5,b.W2,b.PQ,H.G,F.a,Y.U,q.f,j,$.C,X.L,i.uU,tt.k,et],styles:["svg[_ngcontent-%COMP%]:not(:root){overflow:hidden}svg[_ngcontent-%COMP%]{display:block;width:100%}.SVGline[_ngcontent-%COMP%]{stroke:#141;stroke-width:3}rect[_ngcontent-%COMP%]{fill:transparent}rect.eventBorder[_ngcontent-%COMP%]{fill:transparent;stroke-opacity:0;transition:fill .3s ease;cursor:pointer}line[_ngcontent-%COMP%]{stroke:var(--gray-700);stroke-width:.5}.eventStatusOFF[_ngcontent-%COMP%]{stroke:var(--off-duty);stroke-width:5}.eventStatusSB[_ngcontent-%COMP%]{stroke:var(--split-spleeper-berth);stroke-width:5}.eventStatusD[_ngcontent-%COMP%]{stroke:var(--success-500);stroke-width:5}.eventStatusON[_ngcontent-%COMP%]{stroke:var(--warning-400);stroke-width:5}.eventStatusPC[_ngcontent-%COMP%]{stroke:var(--off-duty);stroke-width:5;stroke-dasharray:7}.eventStatusYM[_ngcontent-%COMP%]{stroke:var(--warning-400);stroke-width:5;stroke-dasharray:7}.eventStatusNP[_ngcontent-%COMP%]{stroke-width:3;stroke:#3c763d}.eventStatusLogin[_ngcontent-%COMP%]{stroke-width:3;stroke:#0321fc;stroke-dasharray:6}.eventStatusLogout[_ngcontent-%COMP%]{stroke-width:3;stroke:red;stroke-dasharray:6}.vertical[_ngcontent-%COMP%]{stroke:#002ed0}.horizontalRed[_ngcontent-%COMP%]{stroke:#db2828;stroke-width:7}.confirm-buttons[_ngcontent-%COMP%]{display:flex;gap:15px}.custom-btn[_ngcontent-%COMP%]{flex:1;display:flex;justify-content:center;align-items:center;padding:15px;border-radius:30px;font-size:16px;font-weight:600;height:50px}.time-inputs[_ngcontent-%COMP%]{display:flex;gap:10px}.time-inputs[_ngcontent-%COMP%]   app-date-time[_ngcontent-%COMP%]{flex:1}.time-inputs[_ngcontent-%COMP%]   app-input[_ngcontent-%COMP%]{flex:1}.location-comments[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:30px}.location-comments[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{height:100px}.current-status[_ngcontent-%COMP%]{fill:var(--gray-400)!important;stroke:var(--gray-400);opacity:.2;stroke-width:1px}.range-container[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;align-items:center;gap:10px;color:var(--gray-500);font-size:12px;font-weight:500;margin-top:5px}.disable-click[_ngcontent-%COMP%]{pointer-events:none}.violation-list[_ngcontent-%COMP%]{margin-top:10px;display:flex;justify-content:flex-start;align-items:center;gap:8px;flex-wrap:wrap}.violation-list[_ngcontent-%COMP%]   .violation-item[_ngcontent-%COMP%]{font-size:11px;color:var(--error-600);border:1px solid var(--error-600);background-color:var(--error-50);padding:5px 10px;border-radius:50px}.error-status-viol[_ngcontent-%COMP%]{fill:var(--error-600)!important;stroke:var(--error-600);opacity:.2;stroke-width:1px}.duty-status-labels[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%], .hour-labels[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%], .durations[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{fill:var(--gray-700)!important}"]}),o})()}];let pt=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[O.Bz.forChild(mt),O.Bz]}),o})();var ht=d(4546),vt=d(4166),ft=d(4877),yt=d(2218),xt=d(8974),_t=d(6441),bt=d(1343),Dt=d(4748),St=d(8134);let Tt=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[i.ez,k.u5,b.Pc,pt,ht.y,vt.v,ft.r,yt.H,xt.p,_t.HosPageModule,bt.E,Dt.e,St.y]}),o})()}}]);