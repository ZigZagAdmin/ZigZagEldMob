"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9306],{9306:(Y,m,o)=>{o.r(m),o.d(m,{LogCertifyPageModule:()=>U});var u=o(6895),y=o(4006),f=o(7151),h=o(5050),c=o(5861),C=o(5670),v=o(3905),x=o(4128),L=o(4171),e=o(8256),P=o(4382),b=o(4465),k=o(9386),I=o(849),D=o(7278),Z=o(3646);const S=["sPad"];function E(a,l){1&a&&e._UZ(0,"ion-spinner",22)}const p=function(a){return{"no-display":a}};function T(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"div",18),e._UZ(1,"img",19),e.TgZ(2,"img",20),e.NdJ("load",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.imageLoaded())}),e.qZA(),e.YNc(3,E,1,0,"ion-spinner",21),e.qZA()}if(2&a){const t=e.oxw();e.xp6(1),e.Q6J("src",t.signatureLink,e.LSH),e.xp6(1),e.Q6J("ngClass",e.VKq(4,p,t.imageLoading))("src",t.logDaily.form.signatureLink,e.LSH),e.xp6(1),e.Q6J("ngIf",t.imageLoading)}}function M(a,l){1&a&&(e.TgZ(0,"span"),e._uU(1,"Save"),e.qZA())}function O(a,l){1&a&&e._UZ(0,"ion-spinner",23)}const _=function(a){return{"disable-click":a}},A=function(a,l){return{"btn-disabled":a,"disable-click":l}},B=[{path:"",component:(()=>{class a{constructor(t,i,n,r,d,g,s){this.navCtrl=t,this.route=i,this.databaseService=n,this.toastService=r,this.dashboardService=d,this.storage=g,this.utilityService=s,this.loading=!1,this.logDate="",this.logId="",this.logDailies=[],this.logEvents=[],this.timeZones={},this.timeZone="",this.signature="",this.signatureFound=!1,this.foundSignatureId="",this.imageLoading=!1,this.signatureLink="",this.isConfirmButtonActive=!1,this.signaturePadOptions={minWidth:2,maxWidth:3,backgroundColor:"#FFFFFF",penColor:"black"}}ngOnInit(){this.timeZones=this.utilityService.checkSeason();let t=this.storage.get("timeZone"),i=(0,v.z)(this.route.queryParams),n=(0,v.z)(this.databaseService.getLogDailies()),r=(0,v.z)(this.databaseService.getLogEvents()),d=this.storage.get("vehicleId");(0,x.D)([i,t,n,r,d]).subscribe(([g,s,N,Q,w])=>{this.logDate=g.date,this.logId=g.logId,this.timeZone=s,this.vehicleId=w,this.logDailies=N,this.logDaily=this.logDailies.find(z=>z.logDailyId===this.logId),this.logEvents=Q})}ngAfterViewInit(){this.initSignaturePad()}ngOnDestroy(){}goBack(){this.navCtrl.navigateBack(["log-item",this.logId])}initSignaturePad(){const t=this.signaturePad.nativeElement;t&&(this.signaturePadEl=new L.Z(t,this.signaturePadOptions),t.addEventListener("touchend",()=>{this.updateSignatureField()}))}restoreSignature(){var t=this;return(0,c.Z)(function*(){const i=t.logDailies.find(n=>""!==n.form.signatureId&&"00000000-0000-0000-0000-000000000000"!==n.form.signatureId);i?(t.signature="",t.signatureLink=i.form.signatureLink,t.foundSignatureId=i.form.signatureId,t.signatureFound=!0,t.activateSave()):(t.signatureFound=!1,t.toastService.showToast("No signature found on other daily logs."))})()}updateSignatureField(){if(this.signaturePad&&!this.signaturePadEl.isEmpty()){const t=this.signaturePadEl.toDataURL().slice(22);this.signature=t}else this.signature="";this.activateSave()}clearSignature(){this.signatureFound&&(this.signatureFound=!1),this.signaturePad&&(this.signaturePadEl.clear(),this.signature=""),this.isConfirmButtonActive=!1}save(){var t=this;return(0,c.Z)(function*(){var i;t.loading=!0,t.signatureFound?(t.logDaily.form.signatureId=t.foundSignatureId,t.logDaily.certified=!0):(t.logDaily.form.signatureId=t.utilityService.uuidv4(),t.logDaily.form.signature=t.signature,t.logDaily.certified=!0);const n=t.logEvents[t.logEvents.length-1];let r={logEventId:t.utilityService.uuidv4(),companyId:"",driverId:t.logDaily.driverId,eventTime:{logDate:(0,u.p6)(new Date,"yyyy-MM-ddTHH:mm:ss","en_US",t.timeZones[t.timeZone]),timeStamp:(new Date).getTime(),timeStampEnd:(new Date).getTime(),timeZone:""},vehicle:{vehicleId:t.vehicleId},eld:{eldId:"00000000-0000-0000-0000-000000000000",macAddress:"",serialNumber:""},location:{locationType:"AUTOMATIC",description:"2mi from Chisinau, Chisinau",latitude:0,longitude:0},sequenceNumber:n?n.sequenceNumber+1:1,type:{name:"Certification (1)",code:"CERTIFICATION_1"},recordStatus:{name:"Driver",code:"DRIVER"},recordOrigin:{name:"Active",code:"ACTIVE"},odometer:0,engineHours:0,malfunction:!1,dataDiagnosticEvent:!1,certificationDate:null===(i=t.logDaily)||void 0===i?void 0:i.logDate,comment:"",eventDataCheck:"",inspection:!1};(yield C.Z.getStatus()).connected?(t.dashboardService.updateLogEvent(r).subscribe(function(){var g=(0,c.Z)(function*(s){yield t.updateLogEvents(r,!0),console.log("Certification LogEvent is on server:",s)});return function(s){return g.apply(this,arguments)}}(),function(){var g=(0,c.Z)(function*(s){console.log("Cerification LogEvent Pushed in offline logEvents array"),yield t.updateLogEvents(r,!1)});return function(s){return g.apply(this,arguments)}}()),t.dashboardService.updateLogDaily(t.logDaily).subscribe(function(){var g=(0,c.Z)(function*(s){t.toastService.showToast("Successfully signed the log certification.","success"),t.loading=!1,s.signatureLink&&(t.logDaily.form.signatureLink=s.signatureLink),yield t.updateIndexLogDaily(t.logDaily,!0).then(()=>{console.log("logDaily got updated on the server: ",s),t.loading=!1,setTimeout(()=>t.goBack(),0)})});return function(s){return g.apply(this,arguments)}}(),function(){var g=(0,c.Z)(function*(s){t.loading=!1,t.toastService.showToast("Could not update the signture. Uploading offline only."),yield t.updateIndexLogDaily(t.logDaily,!1),t.goBack()});return function(s){return g.apply(this,arguments)}}())):(console.log("Updated logEvents in offline array"),t.loading=!1,yield t.updateIndexLogDaily(t.logDaily,!1),yield t.updateLogEvents(r,!1),t.goBack())})()}updateLogDaily(t,i){var n=this;return(0,c.Z)(function*(){t.sent=i,n.logDailies.push(t),yield n.storage.set("logDailies",n.logDailies)})()}updateIndexLogDaily(t,i){var n=this;return(0,c.Z)(function*(){t.sent=i;const r=n.logDailies.findIndex(d=>d.logDailyId===t.logDailyId);-1!==r&&(n.logDailies[r]=t),yield n.storage.set("logDailies",n.logDailies)})()}updateLogEvents(t,i){var n=this;return(0,c.Z)(function*(){t.sent=i,n.logEvents.push(t),yield n.storage.set("logEvents",n.logEvents)})()}updateIndexLogEvents(t,i){var n=this;return(0,c.Z)(function*(){t.sent=i;const r=n.logEvents.findIndex(d=>d.logEventId===t.logEventId);-1!==r&&(n.logEvents[r]=t),yield n.storage.set("logEvents",n.logEvents)})()}activateSave(){this.isConfirmButtonActive=!!(this.signature&&0!==this.signature.length||this.signatureLink&&0!==this.signatureLink.length)}imageLoaded(){this.imageLoading=!1}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(f.SH),e.Y36(h.gz),e.Y36(P.k),e.Y36(b.k),e.Y36(k.s),e.Y36(I.K),e.Y36(D.t))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-log-certify"]],viewQuery:function(t,i){if(1&t&&e.Gf(S,5),2&t){let n;e.iGM(n=e.CRH())&&(i.signaturePad=n.first)}},decls:26,vars:22,consts:[[3,"fullscreen","forceOverscroll"],[3,"title","backButton","backButtonCallback"],[1,"date-label"],[1,"main-container","padding-g"],[1,"canvas-container"],["height","290",2,"touch-action","none","user-select","none",3,"ngClass"],["sPad",""],["class","image-container",4,"ngIf"],[1,"signature-buttons"],[1,"signature-button",3,"click"],[2,"display","flex","flex-direction","column","gap","20px"],[1,"confirm-checkbox"],[1,"checkbox-text"],[1,"confirm-buttons"],[1,"custom-btn","secondary-btn",3,"ngClass","click"],[1,"custom-btn","primary-btn",3,"ngClass","disabled","click"],[4,"ngIf"],["name","circular","color","light","class","spinner",4,"ngIf"],[1,"image-container"],[3,"src"],[3,"ngClass","src","load"],["name","dots","color","dark",4,"ngIf"],["name","dots","color","dark"],["name","circular","color","light",1,"spinner"]],template:function(t,i){1&t&&(e.TgZ(0,"ion-content",0)(1,"app-header",1),e.NdJ("backButtonCallback",function(){return i.goBack()}),e.TgZ(2,"div",2),e._uU(3),e.ALo(4,"date"),e.qZA()(),e.TgZ(5,"div",3)(6,"div")(7,"div",4),e._UZ(8,"canvas",5,6),e.YNc(10,T,4,6,"div",7),e.qZA(),e.TgZ(11,"div",8)(12,"div",9),e.NdJ("click",function(){return i.clearSignature()}),e._uU(13,"Clear signature"),e.qZA(),e.TgZ(14,"div",9),e.NdJ("click",function(){return i.restoreSignature()}),e._uU(15,"Restore signature"),e.qZA()()(),e.TgZ(16,"div",10)(17,"div",11)(18,"div",12),e._uU(19,"I hereby certify that my data entries and my record of duty status for this 24-hour period are true and correct."),e.qZA()(),e.TgZ(20,"div",13)(21,"button",14),e.NdJ("click",function(){return i.goBack()}),e._uU(22,"Back"),e.qZA(),e.TgZ(23,"button",15),e.NdJ("click",function(){return i.save()}),e.YNc(24,M,2,0,"span",16),e.YNc(25,O,1,0,"ion-spinner",17),e.qZA()()()()()),2&t&&(e.Q6J("fullscreen",!0)("forceOverscroll",!1),e.xp6(1),e.Q6J("title","Certify")("backButton",!0),e.xp6(2),e.Oqu(e.xi3(4,12,i.logDate,"EEEE, MMM d")),e.xp6(5),e.Q6J("ngClass",e.VKq(15,p,i.signatureFound)),e.xp6(2),e.Q6J("ngIf",i.signatureFound),e.xp6(11),e.Q6J("ngClass",e.VKq(17,_,i.loading)),e.xp6(2),e.Q6J("ngClass",e.WLB(19,A,!i.isConfirmButtonActive,i.loading))("disabled",!i.isConfirmButtonActive),e.xp6(1),e.Q6J("ngIf",!i.loading),e.xp6(1),e.Q6J("ngIf",i.loading))},dependencies:[u.mk,u.O5,f.W2,f.PQ,Z.G,u.uU],styles:[".main-container[_ngcontent-%COMP%]{width:100%;height:calc(100% - 47px);display:flex;flex-direction:column;justify-content:space-between}.date-label[_ngcontent-%COMP%]{color:var(--gray-700);font-size:18px;font-weight:600}.canvas-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%;height:320px;max-width:500px;background-color:var(--gray-100);border-radius:10px;padding:15px}.canvas-container[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:10px}.signature-buttons[_ngcontent-%COMP%]{display:flex;gap:30px;margin-top:10px}.signature-button[_ngcontent-%COMP%]{font-size:15px;font-weight:500;color:var(--gray-500)}.confirm-buttons[_ngcontent-%COMP%]{display:flex;gap:15px}.custom-btn[_ngcontent-%COMP%]{flex:1;display:flex;justify-content:center;align-items:center;padding:15px;border-radius:30px;font-size:16px;font-weight:600;max-height:49px}.confirm-checkbox[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:15px}.checkbox-text[_ngcontent-%COMP%]{font-size:14px;color:var(--gray-700);font-weight:500}ion-checkbox[_ngcontent-%COMP%]{--size: 20px;--checkbox-background-checked: var(--success-500);--border-color: var(--gray-200);--border-color-checked: transparent;--checkmark-width: 2px}ion-checkbox[_ngcontent-%COMP%]::part(container){border-radius:50%}.btn-disabled[_ngcontent-%COMP%]{background-color:var(--gray-500)!important}.spinner[_ngcontent-%COMP%]{transform:scale(.9)}.image-container[_ngcontent-%COMP%]{width:100%;background-color:#fff;border-radius:10px;display:flex;justify-content:center;align-items:center}.image-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:10px}.no-display[_ngcontent-%COMP%]{display:none;width:0;height:0;border:none}"]}),a})()}];let F=(()=>{class a{}return a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[h.Bz.forChild(B),h.Bz]}),a})();var J=o(4546);let U=(()=>{class a{}return a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[u.ez,y.u5,f.Pc,F,J.y]}),a})()}}]);