"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[503],{503:(K,g,r)=>{r.r(g),r.d(g,{InsertDvirPageModule:()=>Y});var o=r(6895),u=r(4006),c=r(6114),p=r(5050),d=r(5861),f=r(4171),v=r(6321),e=r(8256),m=r(4382),b=r(849),y=r(9386),P=r(7219),S=r(7278),C=r(6994),I=r(4465),D=r(3646),T=r(9534),_=r(2187),Z=r(4081),k=r(1585);function J(a,l){1&a&&e._UZ(0,"ion-spinner",25)}const h=function(a){return{"no-display":a}};function x(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"div",22)(1,"img",23),e.NdJ("load",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.imageLoaded())}),e.qZA(),e.YNc(2,J,1,0,"ion-spinner",24),e.qZA()}if(2&a){const t=e.oxw();e.xp6(1),e.Q6J("ngClass",e.VKq(3,h,t.imageLoading))("src",t.dvir.signatureLink,e.LSH),e.xp6(1),e.Q6J("ngIf",t.imageLoading)}}function M(a,l){1&a&&(e.TgZ(0,"span"),e._uU(1,"Save"),e.qZA())}function V(a,l){1&a&&e._UZ(0,"ion-spinner",26)}const U=function(a){return{"disable-click":a}},O=[{path:"",component:(()=>{class a{constructor(t,i,n,s,R,j,z,H){this.databaseService=t,this.storage=i,this.dashboardService=n,this.internetService=s,this.navCtrl=R,this.utilityService=j,this.shareService=z,this.toastService=H,this.defectsVehicle=v.mK,this.defectsTrailers=v.Jk,this.signaturePadOptions={minWidth:2,maxWidth:3,backgroundColor:"#FFFFFF",penColor:"black"},this.DvirId="",this.dvirs=[],this.bReady=!1,this.vehicleUnit="",this.vehicleId="",this.driverId="",this.statusIcon="checkmark-circle-outline",this.networkStatus=!1,this.imageLoading=!1,this.dvir={dvirId:this.utilityService.uuidv4(),driver:{driverId:""},vehicle:{vehicleUnit:"",vehicleId:""},odometer:0,trailers:"",defectsVehicle:"",defectsTrailers:"",remarks:"",status:{code:"",name:""},location:{description:"",latitude:0,longitude:0},createDate:new Date((0,o.p6)(new Date,"yyyy-MM-ddTHH:mm:ss","en-US")).getTime(),createTimeZone:"",repairDate:0,repairTimeZone:"",signatureId:this.utilityService.uuidv4(),signatureBase64:"",signatureLink:""},this.validation={trailerName:!1,locationDescription:!1},this.locationDisable=!1,this.vehicleUnitDisable=!1,this.lastStatus="",this.optionDisable=!0,this.loading=!1,this.signatureFound=!1}ngOnInit(){var t=this;return(0,d.Z)(function*(){t.dvir.status.name="Vehicle Condition Satisfactory",t.dvir.status.code="VCS",t.dvir.defectsVehicle="",t.dvir.defectsTrailers="",t.initSignaturePad(),t.databaseSubscription=t.databaseService.databaseReadySubject.subscribe(i=>{i&&(t.bReady=i,t.databaseService.getCompany().subscribe(n=>{t.company=n}),t.databaseService.getDvirs().subscribe(n=>{t.dvirs=n}))}),t.vehicleUnit=yield t.storage.get("vehicleUnit"),t.vehicleUnitDisable=!!t.vehicleUnit,t.vehicleId=yield t.storage.get("vehicleId"),t.driverId=yield t.storage.get("driverId"),t.networkSub=t.internetService.internetStatus$.subscribe(i=>{t.networkStatus=i,console.log("Intenet Status"+i)})})()}ngOnDestroy(){this.shareService.destroyMessage()}checkSelectPresent(t){this.switchStatus(""===this.dvir.defectsTrailers&&""===this.dvir.defectsVehicle?"VCS":"D")}switchStatus(t){0!==t.length&&t!==this.lastStatus&&(console.log(t),this.lastStatus=t,this.dvir.status.code=t,this.dvir.status.name=v.bO.find(i=>i.code===t).name)}initSignaturePad(){const t=document.querySelector("canvas");t&&(this.signaturePad=new f.Z(t,this.signaturePadOptions),t.addEventListener("touchend",()=>{this.updateSignatureField()}))}updateSignatureField(){if(this.signaturePad&&!this.signaturePad.isEmpty()){const t=this.signaturePad.toDataURL().slice(22);this.dvir.signatureBase64=t}else this.dvir.signatureBase64=""}restoreSignature(){var t=this;return(0,d.Z)(function*(){const i=t.dvirs.find(n=>""!==n.signatureId&&"00000000-0000-0000-0000-000000000000"!==n.signatureId&&""!==n.signatureLink);i?(t.dvir.signatureBase64="",t.dvir.signatureLink=i.signatureLink,t.dvir.signatureId=i.signatureId,console.log(i),t.signatureFound=!0):(t.signatureFound=!1,t.toastService.showToast("No signature found on other daily logs."))})()}clearSignature(){this.signatureFound&&(this.signatureFound=!1,this.dvir.signatureLink=""),this.signaturePad&&(this.signaturePad.clear(),this.dvir.signatureBase64="")}imageLoaded(){this.imageLoading=!1}onSubmit(){var t=this;return(0,d.Z)(function*(){if(t.shareService.changeMessage("reset"),0===t.dvir.defectsTrailers.length&&(t.validation.trailerName=!0),t.shareService.changeMessage(t.utilityService.generateString(5)),t.utilityService.validateForm(t.validation)){if(0===t.dvir.signatureBase64.length&&0===t.dvir.signatureLink.length)return void t.toastService.showToast("Please sign the form before saving!");t.dvir.vehicle.vehicleUnit=t.vehicleUnit,t.dvir.vehicle.vehicleId=t.vehicleId,t.dvir.driver.driverId=t.driverId,console.log("here"),!0===t.networkStatus?(t.loading=!0,t.dashboardService.updateDVIR(t.dvir).toPromise().then(function(){var i=(0,d.Z)(function*(n){n.signatureLink&&(t.dvir.signatureLink=n.signatureLink),yield t.updateDvirs(t.dvir,!0).then(()=>{console.log("DVIRs got updated on the server: ",n),t.loading=!1,t.navCtrl.navigateBack("/unitab/dvir")})});return function(n){return i.apply(this,arguments)}}()).catch(function(){var i=(0,d.Z)(function*(n){yield t.updateDvirs(t.dvir,!1).then(()=>{t.loading=!1,t.navCtrl.navigateBack("/unitab/dvir"),console.warn("Server Error: ",n),console.warn("Pushed dvirs in offline mode")})});return function(n){return i.apply(this,arguments)}}())):yield t.updateDvirs(t.dvir,!1).then(()=>{t.loading=!1,console.warn("Pushed dvirs in offline mode"),t.navCtrl.navigateBack("/unitab/dvir")})}})()}updateDvirs(t,i){var n=this;return(0,d.Z)(function*(){t.sent=i,n.dvirs.unshift(t),yield n.storage.set("dvirs",n.dvirs)})()}ionViewWillLeave(){this.databaseSubscription&&this.databaseSubscription.unsubscribe(),this.networkSub.unsubscribe()}goBack(){this.navCtrl.navigateBack("/unitab/dvir"),this.shareService.destroyMessage()}getHour(t){return(0,o.p6)(t,"LLL d'th', yyyy","en_US")}getTime(t){return(0,o.p6)(t,"hh:mm a","en_US")}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(m.k),e.Y36(b.K),e.Y36(y.s),e.Y36(P.W),e.Y36(c.SH),e.Y36(S.t),e.Y36(C.t),e.Y36(I.k))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-insert-dvir"]],decls:44,vars:67,consts:[[3,"title","backButton","backButtonCallback"],[1,"padding-g",2,"padding-top","10px"],[1,"edit-form"],[1,"subtitle-lg"],[1,"edit-dvir-block"],[3,"label","fill","type","disabled","value","noValidation"],[1,"two-inputs"],[3,"label","fill","type","disabled","value","validation","valueChange","validationChange"],[3,"label","value","options","valueChange","changeDetection"],[3,"label","fill","type","value","validation","noValidation","valueChange","validationChange"],[1,"input-block-2"],[3,"half","value","disableOption","selectedValue","valueChange"],[3,"label","fill","type","value","noValidation","valueChange"],[1,"canvas-container"],["height","200",2,"touch-action","none","user-select","none",3,"ngClass"],["sPad",""],["class","image-container",4,"ngIf"],[1,"signature-buttons"],[1,"signature-button",3,"click"],[1,"btn","primary-btn",3,"ngClass","click"],[4,"ngIf"],["name","circular","color","light",4,"ngIf"],[1,"image-container"],[3,"ngClass","src","load"],["name","dots","color","dark",4,"ngIf"],["name","dots","color","dark"],["name","circular","color","light"]],template:function(t,i){1&t&&(e.TgZ(0,"ion-content")(1,"app-header",0),e.NdJ("backButtonCallback",function(){return i.goBack()}),e.qZA(),e.TgZ(2,"form",1)(3,"div",2)(4,"p",3),e._uU(5,"General Info"),e.qZA(),e.TgZ(6,"div",4),e._UZ(7,"app-input",5),e.TgZ(8,"div",6),e._UZ(9,"app-input",5)(10,"app-input",5),e.qZA(),e.TgZ(11,"app-input",7),e.NdJ("valueChange",function(s){return i.dvir.location.description=s})("validationChange",function(s){return i.validation.locationDescription=s}),e.qZA()(),e.TgZ(12,"p",3),e._uU(13,"Vehicle Info"),e.qZA(),e.TgZ(14,"div",4),e._UZ(15,"app-input",5)(16,"app-input",5),e.TgZ(17,"app-multiple-select",8),e.NdJ("valueChange",function(s){return i.dvir.defectsVehicle=s})("changeDetection",function(s){return i.checkSelectPresent(s)}),e.qZA()(),e.TgZ(18,"p",3),e._uU(19,"Trailer Info"),e.qZA(),e.TgZ(20,"div",4)(21,"app-input",9),e.NdJ("valueChange",function(s){return i.dvir.trailers=s})("validationChange",function(s){return i.validation.trailerName=s}),e.qZA(),e.TgZ(22,"app-multiple-select",8),e.NdJ("valueChange",function(s){return i.dvir.defectsTrailers=s})("changeDetection",function(s){return i.checkSelectPresent(s)}),e.qZA()(),e.TgZ(23,"p",3),e._uU(24,"Status"),e.qZA(),e.TgZ(25,"div",4)(26,"div",10)(27,"app-status-radio-button",11),e.NdJ("selectedValue",function(s){return i.switchStatus(s)})("valueChange",function(s){return i.dvir.status.code=s}),e.qZA()(),e.TgZ(28,"app-textarea",12),e.NdJ("valueChange",function(s){return i.dvir.comments=s}),e.qZA()(),e.TgZ(29,"p",3),e._uU(30,"Signature"),e.qZA(),e.TgZ(31,"div")(32,"div",13),e._UZ(33,"canvas",14,15),e.YNc(35,x,3,5,"div",16),e.qZA(),e.TgZ(36,"div",17)(37,"div",18),e.NdJ("click",function(){return i.clearSignature()}),e._uU(38,"Clear signature"),e.qZA(),e.TgZ(39,"div",18),e.NdJ("click",function(){return i.restoreSignature()}),e._uU(40,"Restore signature"),e.qZA()()(),e.TgZ(41,"button",19),e.NdJ("click",function(){return i.onSubmit()}),e.YNc(42,M,2,0,"span",20),e.YNc(43,V,1,0,"ion-spinner",21),e.qZA()()()()),2&t&&(e.xp6(1),e.Q6J("title","Insert Dvir")("backButton",!0),e.xp6(6),e.Q6J("label","Company")("fill",!0)("type","text")("disabled",!0)("value",null==i.company?null:i.company.name)("noValidation",!0),e.xp6(2),e.Q6J("label","Time")("fill",!0)("type","text")("disabled",!0)("value",i.getHour(i.dvir.createDate))("noValidation",!0),e.xp6(1),e.Q6J("label","none")("fill",!0)("type","text")("disabled",!0)("value",i.getTime(i.dvir.createDate))("noValidation",!0),e.xp6(1),e.Q6J("label","Location")("fill",!0)("type","text")("disabled",i.locationDisable)("value",i.dvir.location.description)("validation",i.validation.locationDescription),e.xp6(4),e.Q6J("label","Vehicle Name")("fill",!0)("type","text")("disabled",i.vehicleUnitDisable)("value",i.vehicleUnit)("noValidation",!0),e.xp6(1),e.Q6J("label","Odometer")("fill",!0)("type","text")("disabled",!0)("value",i.dvir.odometer.toString())("noValidation",!0),e.xp6(1),e.Q6J("label","Vehicle Defects (Optional)")("value",i.dvir.defectsVehicle)("options",i.defectsVehicle),e.xp6(4),e.Q6J("label","Trailer Name")("fill",!0)("type","text")("value",i.dvir.trailers)("validation",i.validation.trailerName)("noValidation",!i.dvir.defectsTrailers.length),e.xp6(1),e.Q6J("label","Trailer Defects (Optional)")("value",i.dvir.defectsTrailers)("options",i.defectsTrailers),e.xp6(5),e.Q6J("half",!0)("value",i.dvir.status.code)("disableOption",!0),e.xp6(1),e.Q6J("label","Comments")("fill",!0)("type","text")("value",i.dvir.comments)("noValidation",!0),e.xp6(5),e.Q6J("ngClass",e.VKq(63,h,i.signatureFound)),e.xp6(2),e.Q6J("ngIf",i.signatureFound),e.xp6(6),e.Q6J("ngClass",e.VKq(65,U,i.loading)),e.xp6(1),e.Q6J("ngIf",!i.loading),e.xp6(1),e.Q6J("ngIf",i.loading))},dependencies:[o.mk,o.O5,u._Y,u.JL,u.F,c.W2,c.PQ,D.G,T.D,_.a,Z.R,k.M],styles:[".input-block-2[_ngcontent-%COMP%]   textarea.input-2[_ngcontent-%COMP%]{height:89px;resize:none}.text-success[_ngcontent-%COMP%]{flex-grow:1;color:var(--success-500);font-size:16px;font-weight:500}.text-error[_ngcontent-%COMP%]{flex-grow:1;color:var(--error-500);font-size:16px;font-weight:600}.btn[_ngcontent-%COMP%]{width:100%;height:50px;border-radius:30px;margin-top:5px}.two-inputs[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:10px}.signature-container[_ngcontent-%COMP%]{width:100%;background-color:var(--gray-100);border-radius:10px;padding:15px;display:flex;justify-content:center;align-items:center}.signature-container[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{width:100%;border-radius:10px}.signature-buttons[_ngcontent-%COMP%]{display:flex;gap:30px;margin-top:10px}.signature-button[_ngcontent-%COMP%]{font-size:15px;font-weight:500;color:var(--gray-500)}.canvas-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%;height:230px;max-width:500px;background-color:var(--gray-100);border-radius:10px;padding:15px}.canvas-container[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:10px}.image-container[_ngcontent-%COMP%]{width:100%;background-color:#fff;border-radius:10px;display:flex;justify-content:center;align-items:center}.image-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:10px}.no-display[_ngcontent-%COMP%]{display:none;width:0;height:0;border:none}"]}),a})()}];let L=(()=>{class a{}return a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[p.Bz.forChild(O),p.Bz]}),a})();var N=r(4546),A=r(7484),B=r(4166),F=r(8546),Q=r(4877),w=r(6330);let Y=(()=>{class a{}return a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[o.ez,u.u5,u.UX,c.Pc,L,N.y,A.T,B.v,F.w,Q.r,w._]}),a})()}}]);