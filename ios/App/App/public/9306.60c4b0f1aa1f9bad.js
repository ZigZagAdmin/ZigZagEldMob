"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9306,4546],{4546:(_,C,a)=>{a.d(C,{y:()=>r});var d=a(6895),T=a(4006),y=a(7151),v=a(8256);let r=(()=>{class p{}return p.\u0275fac=function(l){return new(l||p)},p.\u0275mod=v.oAB({type:p}),p.\u0275inj=v.cJS({imports:[d.ez,T.u5,y.Pc]}),p})()},8924:(_,C,a)=>{a.d(C,{Eb:()=>d,Rk:()=>v,W3:()=>y,bm:()=>T});const d={ET:"UTC-4",EST:"UTC-5",EDT:"UTC-4",CT:"UTC-5",CST:"UTC-6",CDT:"UTC-5",MT:"UTC-6",MST:"UTC-7",MDT:"UTC-6",PT:"UTC-7",PST:"UTC-8",PDT:"UTC-7",AT:"UTC-8",AKT:"UTC-8",AKST:"UTC-9",AKDT:"UTC-8",HT:"UTC-9",HST:"UTC-10",HAST:"UTC-9"},T={ET:"UTC-5",EST:"UTC-5",EDT:"UTC-4",CT:"UTC-6",CST:"UTC-6",CDT:"UTC-5",MT:"UTC-7",MST:"UTC-7",MDT:"UTC-6",PT:"UTC-8",PST:"UTC-8",PDT:"UTC-7",AT:"UTC-9",AKT:"UTC-9",AKST:"UTC-9",AKDT:"UTC-8",HT:"UTC-10",HST:"UTC-10",HAST:"UTC-9"},y={ET:"UTC-5",EST:"UTC-5",EDT:"UTC-4",CT:"UTC-6",CST:"UTC-6",CDT:"UTC-5",MT:"UTC-7",MST:"UTC-7",MDT:"UTC-6",PT:"UTC-8",PST:"UTC-8",PDT:"UTC-7",AT:"UTC-9",AKT:"UTC-9",AKST:"UTC-9",AKDT:"UTC-8",HT:"UTC-10",HST:"UTC-10",HAST:"UTC-9"},v={2024:{summer:17100288e5,winter:173059194e4},2025:{summer:17414784e5,winter:176204154e4},2026:{summer:1772928e6,winter:179349114e4},2027:{summer:18049824e5,winter:182554554e4}}},9306:(_,C,a)=>{a.r(C),a.d(C,{LogCertifyPageModule:()=>z});var d=a(6895),T=a(4006),y=a(7151),v=a(5050),r=a(5861),p=a(5670),s=a(3905),l=a(4128),f=a(4171),e=a(8256),D=a(4382),U=a(4465),E=a(9386),S=a(849),b=a(7278),I=a(3646);const Z=["sPad"];function O(o,u){1&o&&e._UZ(0,"ion-spinner",23)}const P=function(o){return{"no-display":o}};function k(o,u){if(1&o){const t=e.EpF();e.TgZ(0,"div",19),e._UZ(1,"img",20),e.TgZ(2,"img",21),e.NdJ("load",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.imageLoaded())}),e.qZA(),e.YNc(3,O,1,0,"ion-spinner",22),e.qZA()}if(2&o){const t=e.oxw();e.xp6(1),e.Q6J("src",t.signatureLink,e.LSH),e.xp6(1),e.Q6J("ngClass",e.VKq(4,P,t.imageLoading))("src",t.logDaily.form.signatureLink,e.LSH),e.xp6(1),e.Q6J("ngIf",t.imageLoading)}}function A(o,u){1&o&&(e.TgZ(0,"span"),e._uU(1,"Save"),e.qZA())}function B(o,u){1&o&&e._UZ(0,"ion-spinner",24)}function F(o,u){if(1&o){const t=e.EpF();e.TgZ(0,"div",25)(1,"div",26),e._uU(2,"Whould you like to sign the other days?"),e.qZA(),e.TgZ(3,"div",27),e._uU(4,"Rememeber that only the days that do not have logs will be signed!"),e.qZA()(),e.TgZ(5,"div",28)(6,"div",29),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.closeModal())}),e._uU(7,"Cancel"),e.qZA(),e.TgZ(8,"div",30),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.confirmModal())}),e._uU(9,"Confirm"),e.qZA()()}}const w=function(o){return{"disable-click":o}},J=function(o,u){return{"btn-disabled":o,"disable-click":u}},K=[{path:"",component:(()=>{class o{constructor(t,i,n,g,h,x,m){this.navCtrl=t,this.route=i,this.databaseService=n,this.toastService=g,this.dashboardService=h,this.storage=x,this.utilityService=m,this.loading=!1,this.logDate="",this.logId="",this.logDailies=[],this.logEvents=[],this.timeZones={},this.timeZone="",this.signature="",this.signatureFound=!1,this.foundSignatureId="",this.imageLoading=!1,this.signatureLink="",this.isConfirmButtonActive=!1,this.signaturePadOptions={minWidth:2,maxWidth:3,backgroundColor:"#FFFFFF",penColor:"black"},this.isModalOpen=!1,this.enableModalTrigger=!1,this.certifyLogDailies=[]}ngOnInit(){this.timeZones=this.utilityService.checkSeason();let t=this.storage.get("timeZone"),i=(0,s.z)(this.route.queryParams),n=(0,s.z)(this.databaseService.getLogDailies()),g=(0,s.z)(this.databaseService.getLogEvents()),h=this.storage.get("vehicleId");(0,l.D)([i,t,n,g,h]).subscribe(([x,m,c,L,M])=>{this.logDate=x.date,this.logId=x.logId,this.timeZone=m,this.vehicleId=M,this.logDailies=c,this.logDaily=this.logDailies.find(R=>R.logDailyId===this.logId),this.logEvents=L})}ngAfterViewInit(){this.initSignaturePad()}ngOnDestroy(){}goBack(){this.navCtrl.navigateBack(["log-item",this.logId])}initSignaturePad(){const t=this.signaturePad.nativeElement;t&&(this.signaturePadEl=new f.Z(t,this.signaturePadOptions),t.addEventListener("touchend",()=>{this.updateSignatureField()}))}restoreSignature(){var t=this;return(0,r.Z)(function*(){const i=t.logDailies.find(n=>""!==n.form.signatureId&&"00000000-0000-0000-0000-000000000000"!==n.form.signatureId);i?(t.signature="",t.signatureLink=i.form.signatureLink,t.foundSignatureId=i.form.signatureId,t.signatureFound=!0,t.activateSave()):(t.signatureFound=!1,t.toastService.showToast("No signature found on other daily logs."))})()}updateSignatureField(){if(this.signaturePad&&!this.signaturePadEl.isEmpty()){const t=this.signaturePadEl.toDataURL().slice(22);this.signature=t}else this.signature="";this.activateSave()}clearSignature(){this.signatureFound&&(this.signatureFound=!1),this.signaturePad&&(this.signaturePadEl.clear(),this.signature=""),this.isConfirmButtonActive=!1}save(t=""){var i=this;return(0,r.Z)(function*(){var n;if(i.loading=!0,i.signatureFound?(i.logDaily.form.signatureId=i.foundSignatureId,i.logDaily.certified=!0):(i.logDaily.form.signatureId=i.utilityService.uuidv4(),i.logDaily.form.signature=i.signature,i.logDaily.certified=!0),0===t.length){let m=i.logEvents.slice().reverse().filter(c=>["OFF","SB","D","ON","PC","YM"].includes(c.type.code));i.logDailies.forEach(c=>{-1===m.findIndex(M=>M.eventTime.logDate===c.logDate)&&(i.logDaily.formManner=!0)})}const g=i.logEvents[i.logEvents.length-1];let h={logEventId:i.utilityService.uuidv4(),companyId:"",driverId:i.logDaily.driverId,eventTime:{logDate:(0,d.p6)(new Date,"yyyy-MM-ddTHH:mm:ss","en_US",i.timeZones[i.timeZone]),timeStamp:(new Date).getTime(),timeStampEnd:(new Date).getTime(),timeZone:""},vehicle:{vehicleId:i.vehicleId},eld:{eldId:"00000000-0000-0000-0000-000000000000",macAddress:"",serialNumber:""},sequenceNumber:g?g.sequenceNumber+1:1,type:{name:"Certification (1)",code:"CERTIFICATION_1"},recordStatus:{name:"Active",code:"ACTIVE"},malfunction:!1,dataDiagnosticEvent:!1,certificationDate:null===(n=i.logDaily)||void 0===n?void 0:n.logDate,comment:"",eventDataCheck:"",inspection:!1};(yield p.Z.getStatus()).connected?(yield(0,s.z)(i.dashboardService.updateLogEvent(h)).then(function(){var m=(0,r.Z)(function*(c){yield i.updateLogEvents(h,!0),console.log("Certification LogEvent is on server:",c)});return function(c){return m.apply(this,arguments)}}(),function(){var m=(0,r.Z)(function*(c){console.log("Cerification LogEvent Pushed in offline logEvents array"),yield i.updateLogEvents(h,!1)});return function(c){return m.apply(this,arguments)}}()),yield(0,s.z)(i.dashboardService.updateLogDaily(i.logDaily)).then(function(){var m=(0,r.Z)(function*(c){i.toastService.showToast("Successfully signed the log certification.","success"),c.signatureLink&&(i.logDaily.form.signatureLink=c.signatureLink),yield i.updateIndexLogDaily(i.logDaily,!0).then(()=>{console.log("logDaily got updated on the server: ",c),(0===t.length||0!==t.length&&i.logDailies[i.certifyLogDailies[i.certifyLogDailies.length-1]].logDailyId===i.logDaily.logDailyId)&&(i.loading=!1,setTimeout(()=>i.goBack(),0))})});return function(c){return m.apply(this,arguments)}}(),function(){var m=(0,r.Z)(function*(c){i.toastService.showToast("Could not update the signture. Uploading offline only."),yield i.updateIndexLogDaily(i.logDaily,!1),(0===t.length||0!==t.length&&i.logDailies[i.certifyLogDailies[i.certifyLogDailies.length-1]].logDailyId===i.logDaily.logDailyId)&&(i.loading=!1,i.goBack())});return function(c){return m.apply(this,arguments)}}())):(console.log("Updated logEvents in offline array"),yield i.updateIndexLogDaily(i.logDaily,!1),yield i.updateLogEvents(h,!1),(0===t.length||0!==t.length&&i.logDailies[i.certifyLogDailies[i.certifyLogDailies.length-1]].logDailyId===i.logDaily.logDailyId)&&(i.loading=!1,i.goBack()))})()}updateLogDaily(t,i){var n=this;return(0,r.Z)(function*(){t.sent=i,n.logDailies.push(t),yield n.storage.set("logDailies",n.logDailies)})()}updateIndexLogDaily(t,i){var n=this;return(0,r.Z)(function*(){t.sent=i;const g=n.logDailies.findIndex(h=>h.logDailyId===t.logDailyId);-1!==g&&(n.logDailies[g]=t),yield n.storage.set("logDailies",n.logDailies)})()}updateLogEvents(t,i){var n=this;return(0,r.Z)(function*(){t.sent=i,n.logEvents.push(t),yield n.storage.set("logEvents",n.logEvents)})()}updateIndexLogEvents(t,i){var n=this;return(0,r.Z)(function*(){t.sent=i;const g=n.logEvents.findIndex(h=>h.logEventId===t.logEventId);-1!==g&&(n.logEvents[g]=t),yield n.storage.set("logEvents",n.logEvents)})()}activateSave(){this.isConfirmButtonActive=!!(this.signature&&0!==this.signature.length||this.signatureLink&&0!==this.signatureLink.length)}closeModal(){var t=this;return(0,r.Z)(function*(){t.isModalOpen=!1,yield t.save()})()}confirmModal(){var t=this;return(0,r.Z)(function*(){t.isModalOpen=!1;for(const i of t.certifyLogDailies)t.logDaily=t.logDailies[i],console.log(t.logDaily),t.logDaily.formManner=!0,t.logDaily.certified=!0,t.logDaily.form.signatureId=t.utilityService.uuidv4(),t.logDaily.form.signature=t.signature,yield t.save("nocheck")})()}openModal(){var t=this;return(0,r.Z)(function*(){t.certifyLogDailies=[];let i=t.logEvents.slice().reverse().filter(n=>["OFF","SB","D","ON","PC","YM"].includes(n.type.code));if(t.logDailies.forEach((n,g)=>{-1===i.findIndex(x=>x.eventTime.logDate===n.logDate)&&!n.certified&&n.logDate!==(0,d.p6)(new Date,"yyyy/MM/d","en_US",t.timeZones[t.timeZone])&&t.certifyLogDailies.push(g)}),console.log(t.certifyLogDailies),0!==t.certifyLogDailies.length){t.enableModalTrigger=!0,t.isModalOpen=!0;let n=t.logDailies.findIndex(g=>g.logDailyId===t.logDaily.logDailyId);t.certifyLogDailies.includes(n)||t.certifyLogDailies.push(t.logDailies.findIndex(g=>g.logDailyId===t.logDaily.logDailyId))}else t.enableModalTrigger=!1,t.isModalOpen=!1,yield t.save()})()}imageLoaded(){this.imageLoading=!1}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(y.SH),e.Y36(v.gz),e.Y36(D.k),e.Y36(U.k),e.Y36(E.s),e.Y36(S.K),e.Y36(b.t))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-log-certify"]],viewQuery:function(t,i){if(1&t&&e.Gf(Z,5),2&t){let n;e.iGM(n=e.CRH())&&(i.signaturePad=n.first)}},decls:28,vars:24,consts:[[3,"fullscreen","forceOverscroll"],[3,"title","backButton","backButtonCallback"],[1,"date-label"],[1,"main-container","padding-g"],[1,"canvas-container"],["height","290",2,"touch-action","none","user-select","none",3,"ngClass"],["sPad",""],["class","image-container",4,"ngIf"],[1,"signature-buttons"],[1,"signature-button",3,"click"],[2,"display","flex","flex-direction","column","gap","20px"],[1,"confirm-checkbox"],[1,"checkbox-text"],[1,"confirm-buttons"],[1,"custom-btn","secondary-btn",3,"ngClass","click"],["id","certify-modal-trigger",1,"custom-btn","primary-btn",3,"ngClass","disabled","click"],[4,"ngIf"],["name","circular","color","light","class","spinner",4,"ngIf"],["id","custom-modal",3,"isOpen","trigger"],[1,"image-container"],[3,"src"],[3,"ngClass","src","load"],["name","dots","color","dark",4,"ngIf"],["name","dots","color","dark"],["name","circular","color","light",1,"spinner"],[1,"modal-box"],[1,"modal-title"],[1,"modal-subtitle"],[1,"submit-buttons"],[1,"action-button","default",3,"click"],[1,"action-button","primary",3,"click"]],template:function(t,i){1&t&&(e.TgZ(0,"ion-content",0)(1,"app-header",1),e.NdJ("backButtonCallback",function(){return i.goBack()}),e.TgZ(2,"div",2),e._uU(3),e.ALo(4,"date"),e.qZA()(),e.TgZ(5,"div",3)(6,"div")(7,"div",4),e._UZ(8,"canvas",5,6),e.YNc(10,k,4,6,"div",7),e.qZA(),e.TgZ(11,"div",8)(12,"div",9),e.NdJ("click",function(){return i.clearSignature()}),e._uU(13,"Clear signature"),e.qZA(),e.TgZ(14,"div",9),e.NdJ("click",function(){return i.restoreSignature()}),e._uU(15,"Restore signature"),e.qZA()()(),e.TgZ(16,"div",10)(17,"div",11)(18,"div",12),e._uU(19,"I hereby certify that my data entries and my record of duty status for this 24-hour period are true and correct."),e.qZA()(),e.TgZ(20,"div",13)(21,"button",14),e.NdJ("click",function(){return i.goBack()}),e._uU(22,"Back"),e.qZA(),e.TgZ(23,"button",15),e.NdJ("click",function(){return i.openModal()}),e.YNc(24,A,2,0,"span",16),e.YNc(25,B,1,0,"ion-spinner",17),e.qZA()()()(),e.TgZ(26,"ion-modal",18),e.YNc(27,F,10,0,"ng-template"),e.qZA()()),2&t&&(e.Q6J("fullscreen",!0)("forceOverscroll",!1),e.xp6(1),e.Q6J("title","Certify")("backButton",!0),e.xp6(2),e.Oqu(e.xi3(4,14,i.logDate,"EEEE, MMM d")),e.xp6(5),e.Q6J("ngClass",e.VKq(17,P,i.signatureFound)),e.xp6(2),e.Q6J("ngIf",i.signatureFound),e.xp6(11),e.Q6J("ngClass",e.VKq(19,w,i.loading)),e.xp6(2),e.Q6J("ngClass",e.WLB(21,J,!i.isConfirmButtonActive,i.loading))("disabled",!i.isConfirmButtonActive),e.xp6(1),e.Q6J("ngIf",!i.loading),e.xp6(1),e.Q6J("ngIf",i.loading),e.xp6(1),e.Q6J("isOpen",i.isModalOpen)("trigger",i.enableModalTrigger?"certify-modal-trigger":void 0))},dependencies:[d.mk,d.O5,y.W2,y.PQ,y.ki,I.G,d.uU],styles:[".main-container[_ngcontent-%COMP%]{width:100%;height:calc(100% - 47px);display:flex;flex-direction:column;justify-content:space-between}.date-label[_ngcontent-%COMP%]{color:var(--gray-700);font-size:18px;font-weight:600}.canvas-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%;height:320px;max-width:500px;background-color:var(--gray-100);border-radius:10px;padding:15px}.canvas-container[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:10px}.signature-buttons[_ngcontent-%COMP%]{display:flex;gap:30px;margin-top:10px}.signature-button[_ngcontent-%COMP%]{font-size:15px;font-weight:500;color:var(--gray-500)}.confirm-buttons[_ngcontent-%COMP%]{display:flex;gap:15px}.custom-btn[_ngcontent-%COMP%]{flex:1;display:flex;justify-content:center;align-items:center;padding:15px;border-radius:30px;font-size:16px;font-weight:600;max-height:49px}.confirm-checkbox[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:15px}.checkbox-text[_ngcontent-%COMP%]{font-size:14px;color:var(--gray-700);font-weight:500}ion-checkbox[_ngcontent-%COMP%]{--size: 20px;--checkbox-background-checked: var(--success-500);--border-color: var(--gray-200);--border-color-checked: transparent;--checkmark-width: 2px}ion-checkbox[_ngcontent-%COMP%]::part(container){border-radius:50%}.btn-disabled[_ngcontent-%COMP%]{background-color:var(--gray-500)!important}.spinner[_ngcontent-%COMP%]{transform:scale(.9)}.image-container[_ngcontent-%COMP%]{width:100%;background-color:#fff;border-radius:10px;display:flex;justify-content:center;align-items:center}.image-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:10px}.no-display[_ngcontent-%COMP%]{display:none;width:0;height:0;border:none}.modal-box[_ngcontent-%COMP%]{padding:20px 20px 0;display:flex;flex-direction:column;gap:10px}.modal-title[_ngcontent-%COMP%]{font-size:16px;font-weight:600}.modal-subtitle[_ngcontent-%COMP%]{font-size:14px;font-weight:400}.modal-status[_ngcontent-%COMP%]{font-size:15px}ion-modal#custom-modal[_ngcontent-%COMP%]{--width: 85%;--min-width: 80%;--max-height: 100%;--overflow: hidden;--height: fit-content;--border-radius: 10px;--box-shadow: 0 28px 48px rgba(0, 0, 0, .4);pointer-events:none}.submit-buttons[_ngcontent-%COMP%]{display:flex;align-items:center;gap:5px;width:100%;padding:15px 20px 20px}.submit-buttons[_ngcontent-%COMP%]   .action-button[_ngcontent-%COMP%]{flex:1;font-size:15px;display:flex;justify-content:center;align-items:center;height:38px;padding:10px;border-radius:50px;cursor:pointer}.default[_ngcontent-%COMP%]{color:var(--gray-500);background-color:var(--gray-100)}.primary[_ngcontent-%COMP%]{color:var(--gray-25);background-color:var(--primary-600)}"]}),o})()}];let H=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[v.Bz.forChild(K),v.Bz]}),o})();var N=a(4546);let z=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[d.ez,T.u5,y.Pc,H,N.y]}),o})()},7278:(_,C,a)=>{a.d(C,{t:()=>v});var d=a(8924),T=a(8256),y=a(849);let v=(()=>{class r{constructor(s){this.storage=s}generateString(s){const l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let f=" ";const e=l.length;for(let D=0;D<s;D++)f+=l.charAt(Math.floor(Math.random()*e));return f}validateForm(s){let l=!0;for(const f in s)l=l&&s[f];return l}uuidv4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){const l=16*Math.random()|0;return("x"==s?l:3&l|8).toString(16)})}msToTime(s){let l=Math.floor(s/1e3%60),f=Math.floor(s/6e4%60),e=Math.floor(s/36e5);return e=e<10?"0"+e:e,f=f<10?"0"+f:f,l=l<10?"0"+l:l,e+"h "+f+"min "+l+"s"}checkSeason(){return(new Date).getTime()>=d.Rk[(new Date).getFullYear().toString()].summer&&(new Date).getTime()<d.Rk[(new Date).getFullYear().toString()].winter?d.Eb:d.bm}}return r.\u0275fac=function(s){return new(s||r)(T.LFG(y.K))},r.\u0275prov=T.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})()}}]);